<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example: Social Anxiety • multinma</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Example: Social Anxiety">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js" integrity="sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multinma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/vignette_overview.html">Overview of Examples</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/example_atrial_fibrillation.html">Example: Atrial fibrillation</a></li>
    <li><a class="dropdown-item" href="../articles/example_bcg_vaccine.html">Example: BCG vaccine for tuberculosis</a></li>
    <li><a class="dropdown-item" href="../articles/example_blocker.html">Example: Beta blockers</a></li>
    <li><a class="dropdown-item" href="../articles/example_diabetes.html">Example: Diabetes</a></li>
    <li><a class="dropdown-item" href="../articles/example_dietary_fat.html">Example: Dietary fat</a></li>
    <li><a class="dropdown-item" href="../articles/example_hta_psoriasis.html">Example: Plaque psoriasis HTA report</a></li>
    <li><a class="dropdown-item" href="../articles/example_ndmm.html">Example: Newly diagnosed multiple myeloma</a></li>
    <li><a class="dropdown-item" href="../articles/example_parkinsons.html">Example: Parkinson's disease</a></li>
    <li><a class="dropdown-item" href="../articles/example_plaque_psoriasis.html">Example: Plaque psoriasis ML-NMR</a></li>
    <li><a class="dropdown-item" href="../articles/example_smoking.html">Example: Smoking cessation</a></li>
    <li><a class="dropdown-item" href="../articles/example_social_anxiety.html">Example: Social Anxiety</a></li>
    <li><a class="dropdown-item" href="../articles/example_statins.html">Example: Statins for cholesterol lowering</a></li>
    <li><a class="dropdown-item" href="../articles/example_thrombolytics.html">Example: Thrombolytic treatments</a></li>
    <li><a class="dropdown-item" href="../articles/example_transfusion.html">Example: White blood cell transfusion</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dmphillippo/multinma/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Example: Social Anxiety</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dmphillippo/multinma/blob/master/vignettes/example_social_anxiety.Rmd" class="external-link"><code>vignettes/example_social_anxiety.Rmd</code></a></small>
      <div class="d-none name"><code>example_social_anxiety.Rmd</code></div>
    </div>

    
    
<p>This vignette describes the analysis of 101 trials comparing 41
first-line treatments in 17 classes for social anxiety disorder in
adults <span class="citation">(<a href="#ref-mayo2014psychological">Mayo-Wilson et al. 2014</a>)</span>.
The data are available in this package as
<code>social_anxiety</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">social_anxiety</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   studyn studyc          trtn      y     se trtc                            classn classc      </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1 BOWLER2012         1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     Waitlist                             1 Waitlist    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1 BOWLER2012         6 -<span style="color: #BB0000;">0.916</span>  0.318 Self-help internet no support        5 Self-help n…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      2 ABRAMOWITZ2009     1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     Waitlist                             1 Waitlist    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      2 ABRAMOWITZ2009     7 -<span style="color: #BB0000;">0.956</span>  0.390 Self-help book with support          6 Self-help w…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      3 ANDERSSON2012      1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     Waitlist                             1 Waitlist    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      3 ANDERSSON2012      8 -<span style="color: #BB0000;">0.768</span>  0.125 Self-help internet with support      6 Self-help w…</span></span></code></pre></div>
<p><span class="citation">Mayo-Wilson et al. (<a href="#ref-mayo2014psychological">2014</a>)</span> analysed this dataset
using a NMA model with class effects, which we recreate here. When
fitting class effects models there are multiple modeling options
available.</p>
<p>We demonstrate the model selection strategy proposed by <span class="citation">Perren et al. (<a href="#ref-Perren2025">in
preparation</a>)</span> to determine the most suitable class effects
model.</p>
<div class="section level2">
<h2 id="setting-up-the-network">Setting up the network<a class="anchor" aria-label="anchor" href="#setting-up-the-network"></a>
</h2>
<p>We follow Mayo-Wilson et al. by analysing results as standardised
mean differences (<code>y</code>) with standard errors (<code>se</code>)
therefore we use the function <code>set_agd_contrast</code> to set up
the network. We set treatment classes with
<code>trt_class = classc</code> and set <code>Waitlist</code> as the
network reference treatment.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sa_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_agd_contrast.html">set_agd_contrast</a></span><span class="op">(</span><span class="va">social_anxiety</span>,</span>
<span>                           study <span class="op">=</span> <span class="va">studyc</span>, </span>
<span>                           trt <span class="op">=</span> <span class="va">trtc</span>,</span>
<span>                           y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                           sample_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                           se <span class="op">=</span> <span class="va">se</span>,</span>
<span>                           trt_class <span class="op">=</span> <span class="va">classc</span>,</span>
<span>                           trt_ref <span class="op">=</span> <span class="st">"Waitlist"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sa_net</span></span>
<span><span class="co">#&gt; A network with 101 AgD studies (contrast-based).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #555555;">--------------------------------------------------</span> <span style="font-weight: bold;">AgD studies (contrast-based)</span> <span style="color: #555555;">----</span> </span></span>
<span><span class="co">#&gt;  Study           Treatment arms                                </span></span>
<span><span class="co">#&gt;  ABRAMOWITZ2009  2: Waitlist | Self-help book with support     </span></span>
<span><span class="co">#&gt;  ALDEN2011       2: Waitlist | CBT group                       </span></span>
<span><span class="co">#&gt;  ALLGULANDER1999 2: Paroxetine | Pill placebo                  </span></span>
<span><span class="co">#&gt;  ALLGULANDER2004 3: Paroxetine | Pill placebo | Venlafaxine    </span></span>
<span><span class="co">#&gt;  ANDERSSON2006   2: Waitlist | Exposure in vivo                </span></span>
<span><span class="co">#&gt;  ANDERSSON2012   2: Waitlist | Self-help internet with support </span></span>
<span><span class="co">#&gt;  ANDREWS2011     2: CBT group | Self-help internet with support</span></span>
<span><span class="co">#&gt;  ASAKURA2007     2: Fluvoxamine | Pill placebo                 </span></span>
<span><span class="co">#&gt;  BALDWIN1999     2: Paroxetine | Pill placebo                  </span></span>
<span><span class="co">#&gt;  BERGER2009      2: Waitlist | Self-help internet with support </span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> ... plus 91 more studies</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Outcome type: continuous</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">------------------------------------------------------------------------------------</span></span></span>
<span><span class="co">#&gt; Total number of treatments: 41, in 17 classes</span></span>
<span><span class="co">#&gt; Total number of studies: 101</span></span>
<span><span class="co">#&gt; Reference treatment is: Waitlist</span></span>
<span><span class="co">#&gt; Network is <span style="color: #00BB00;">connected</span></span></span></code></pre></div>
<p>We create a plot at the class level by setting
<code>level = "class"</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sa_net</span>, level <span class="op">=</span> <span class="st">"class"</span>, weight_nodes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.box <span class="op">=</span> <span class="st">"vertical"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_social_anxiety_files/figure-html/unnamed-chunk-6-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="model-selection-strategy">Model selection strategy<a class="anchor" aria-label="anchor" href="#model-selection-strategy"></a>
</h2>
<p>We follow the model selection strategy proposed by <span class="citation">Perren et al. (<a href="#ref-Perren2025">in
preparation</a>)</span></p>
<p><img src="class_effects_flow_chart-1.svg" width="600px" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="step-1-heterogeniety-assessement">STEP 1: Heterogeniety assessement<a class="anchor" aria-label="anchor" href="#step-1-heterogeniety-assessement"></a>
</h3>
<p>First, we assess heterogeneity by fitting fixed effects (FE) and
random effects (RE) models using <code><a href="../reference/nma.html">nma()</a></code> and stating
<code>trt_effects = "random"</code> for the RE model and
<code>trt_effects = "fixed"</code> for the FE model. We use
uninformative priors on the treatment effects with
<code>prior_trt = normal(0, 100)</code> and heterogeneity with
<code>prior_het = half_normal(5)</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">951</span><span class="op">)</span></span>
<span><span class="va">sa_fit_FE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">sa_net</span>,</span>
<span>                 trt_effects <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                 prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                 prior_het <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">half_normal</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sa_fit_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">sa_net</span>,</span>
<span>                 trt_effects <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                 prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                 prior_het <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">half_normal</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<p>The model fit under the FE and RE models can be checked using the
<code><a href="../reference/dic.html">dic()</a></code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sa_dic_FE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">sa_fit_FE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Residual deviance: 288.1<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 39.9</span></span>
<span><span class="co">#&gt;               DIC: 328.1</span></span>
<span><span class="op">(</span><span class="va">sa_dic_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">sa_fit_RE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Residual deviance: 162.6<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 94.3</span></span>
<span><span class="co">#&gt;               DIC: 256.9</span></span></code></pre></div>
<p>The DIC for the random effects model (256.9) is much lower than that
of the fixed effects model (328.1) due to the large decrease in residual
deviance showing a much better fit to the data. Therefore, our preferred
model is the RE model, which we use in subsequent steps.</p>
</div>
<div class="section level3">
<h3 id="step-2-consistency-assessment">STEP 2: Consistency assessment<a class="anchor" aria-label="anchor" href="#step-2-consistency-assessment"></a>
</h3>
<p>The next step is to assess inconsistency using an unrelated mean
effects model (UME), comparing model fit statistics for the UME model
and the NMA (consistency) model, both with RE. To fit a UME model we
specify <code>consistency = "ume"</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sa_UME_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">sa_net</span>,</span>
<span>                 trt_effects <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                 consistency <span class="op">=</span> <span class="st">"ume"</span>,</span>
<span>                 prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                 prior_het <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">half_normal</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We compare model fit from the NMA (consistency) RE model and the UME
RE model using the <code><a href="../reference/dic.html">dic()</a></code> function and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sa_dic_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">sa_fit_RE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Residual deviance: 162.6<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 94.3</span></span>
<span><span class="co">#&gt;               DIC: 256.9</span></span>
<span><span class="op">(</span><span class="va">sa_dic_ume_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">sa_UME_RE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Residual deviance: 161.3<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 109</span></span>
<span><span class="co">#&gt;               DIC: 270.4</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sa_UME_RE</span>, pars <span class="op">=</span> <span class="st">"tau"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     mean   sd 2.5% 25%  50%  75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; tau 0.22 0.03 0.16 0.2 0.22 0.24  0.29      878     2051    1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sa_fit_RE</span>, pars <span class="op">=</span> <span class="st">"tau"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     mean   sd 2.5%  25% 50%  75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; tau 0.21 0.03 0.15 0.18 0.2 0.23  0.27     1127     2095    1</span></span></code></pre></div>
<p>The residual deviance is not meaningfully different between the two
models, however, the DIC is lower in the NMA model (256.9) compared to
the UME model (270.4). There is no evidence of inconsistency at the
global level.</p>
<p>To asses local inconsistency, we use the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function
that produces a “dev-dev” plot of the residual deviance contributions
for the UME model plotted against the NMA consistency model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sa_dic_RE</span>, <span class="va">sa_dic_ume_RE</span>, show_uncertainty <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Residual deviance - No Class model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Residual deviance - UME model"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_social_anxiety_files/figure-html/unnamed-chunk-11-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The dev-dev plot comparing residual deviance contributions for the
UME model and no-class model shows that most data points lie close to
the line of equality.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">sa_dic_RE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">resdev</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;          .study n_contrast   resdev  leverage      dic df</span></span>
<span><span class="co">#&gt; 1     ALDEN2011          1 6.734567 0.4807275 7.215294  1</span></span>
<span><span class="co">#&gt; 2 EMMELKAMP2006          2 6.726275 0.9495117 7.675786  2</span></span>
<span><span class="co">#&gt; 3  STANGIER2003          2 5.370313 1.0404009 6.410714  2</span></span>
<span><span class="co">#&gt; 4  VERSIANI1992          2 4.678505 1.1216433 5.800149  2</span></span>
<span><span class="co">#&gt; 5  HEIMBERG1998          3 4.428477 2.0041343 6.432611  3</span></span></code></pre></div>
<p>We can see from investigating the pointwise contributions to the
residual deviance that the two outlier studies are ALDEN2011 and
EMMELKAMP2006 with their large <code>resdev</code> values in the no
class model.</p>
<p>We can explore the consistency of specific evidence loops using
node-splitting by setting <code>consistency = "nodesplit"</code>.
However, given the size of the network, running node-splitting on all
comparisons would be computationally intensive. We instead run the
node-splitting analysis specifically for the loops that include the
studies identified in the dev-dev plots (ALDEN2011 and EMMELKAMP2006).
We first define the specific treatment comparisons of interest by
creating two data frames that specify the desired treatment comparisons.
These are then passed to the <code>nodesplit</code> argument within the
<code><a href="../reference/nma.html">nma()</a></code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EMMELKAMP2006</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Treatment_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CBT individual"</span>, <span class="st">"Waitlist"</span>, <span class="st">"Waitlist"</span><span class="op">)</span>,</span>
<span>  Treatment_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Psychodynamic psychotherapy"</span>, <span class="st">"Psychodynamic psychotherapy"</span>, <span class="st">"CBT individual"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ALDEN2011</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Treatment_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Waitlist"</span><span class="op">)</span>,</span>
<span>  Treatment_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CBT group"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sa_fit_RE_nodesplit_EMMELKAMP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">sa_net</span>,</span>
<span>                           consistency <span class="op">=</span> <span class="st">"nodesplit"</span>,</span>
<span>                           nodesplit <span class="op">=</span> <span class="va">EMMELKAMP2006</span>,</span>
<span>                           trt_effects <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                           prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                           prior_het <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">half_normal</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting model 1 of 3, node-split: Psychodynamic psychotherapy vs. CBT individual</span></span>
<span><span class="co">#&gt; Fitting model 2 of 3, node-split: Psychodynamic psychotherapy vs. Waitlist</span></span>
<span><span class="co">#&gt; Fitting model 3 of 3, node-split: CBT individual vs. Waitlist</span></span>
<span></span>
<span><span class="va">sa_fit_RE_nodesplit_ALDEN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">sa_net</span>,</span>
<span>                             consistency <span class="op">=</span> <span class="st">"nodesplit"</span>,</span>
<span>                             nodesplit <span class="op">=</span> <span class="va">ALDEN2011</span>,</span>
<span>                             trt_effects <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                             prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                             prior_het <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">half_normal</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting model 1 of 1, node-split: CBT group vs. Waitlist</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sa_fit_RE_nodesplit_ALDEN</span><span class="op">)</span></span>
<span><span class="co">#&gt; Node-splitting model fitted for 1 comparison: CBT group vs. Waitlist.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; d_dir -0.90 0.14 -1.17 -0.99 -0.90 -0.81 -0.63     3562     3110    1</span></span>
<span><span class="co">#&gt; d_ind -0.74 0.14 -1.01 -0.83 -0.73 -0.64 -0.46     1008     1685    1</span></span>
<span><span class="co">#&gt; omega -0.16 0.18 -0.53 -0.28 -0.16 -0.03  0.18     1750     2566    1</span></span>
<span><span class="co">#&gt; tau    0.21 0.03  0.15  0.19  0.21  0.23  0.27     1268     2393    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual deviance: 161.9<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 94.9</span></span>
<span><span class="co">#&gt;               DIC: 256.8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian p-value: 0.38</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sa_fit_RE_nodesplit_EMMELKAMP</span><span class="op">)</span></span>
<span><span class="co">#&gt; Node-splitting models fitted for 3 comparisons.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #555555;">---------------------</span> <span style="font-weight: bold;">Node-split Psychodynamic psychotherapy vs. CBT individual</span> <span style="color: #555555;">----</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       mean   sd  2.5%  25%  50%  75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; d_dir 0.71 0.33  0.07 0.50 0.72 0.93  1.34     4630     3316    1</span></span>
<span><span class="co">#&gt; d_ind 0.44 0.26 -0.08 0.27 0.43 0.61  0.93     2503     2808    1</span></span>
<span><span class="co">#&gt; omega 0.27 0.39 -0.49 0.02 0.28 0.53  1.03     3634     2533    1</span></span>
<span><span class="co">#&gt; tau   0.21 0.03  0.15 0.19 0.21 0.23  0.27     1101     2198    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual deviance: 161.8<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 94.8</span></span>
<span><span class="co">#&gt;               DIC: 256.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian p-value: 0.47</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #555555;">---------------------------</span> <span style="font-weight: bold;">Node-split Psychodynamic psychotherapy vs. Waitlist</span> <span style="color: #555555;">----</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; d_dir -0.60 0.18 -0.95 -0.72 -0.60 -0.48 -0.24     5165     3238    1</span></span>
<span><span class="co">#&gt; d_ind -0.67 0.42 -1.49 -0.96 -0.67 -0.38  0.14     3636     3389    1</span></span>
<span><span class="co">#&gt; omega  0.07 0.44 -0.78 -0.23  0.08  0.37  0.94     3816     3242    1</span></span>
<span><span class="co">#&gt; tau    0.21 0.03  0.15  0.19  0.21  0.23  0.27     1516     2297    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual deviance: 163<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 95.6</span></span>
<span><span class="co">#&gt;               DIC: 258.6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian p-value: 0.87</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #555555;">----------------------------------------</span> <span style="font-weight: bold;">Node-split CBT individual vs. Waitlist</span> <span style="color: #555555;">----</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; d_dir -0.84 0.24 -1.31 -1.00 -0.84 -0.68 -0.37     5278     3755 1.00</span></span>
<span><span class="co">#&gt; d_ind -1.46 0.24 -1.95 -1.62 -1.46 -1.29 -0.98     1636     2329 1.00</span></span>
<span><span class="co">#&gt; omega  0.62 0.34 -0.05  0.39  0.63  0.84  1.29     2198     2805 1.00</span></span>
<span><span class="co">#&gt; tau    0.20 0.03  0.15  0.18  0.20  0.22  0.27     1290     1878 1.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual deviance: 161.7<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 94.3</span></span>
<span><span class="co">#&gt;               DIC: 256</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian p-value: 0.071</span></span></code></pre></div>
<p>Our node‐splitting analysis shows that the CBT individual and
Waitlist comparison has a p-value of 0.065 and a stronger effect for the
indirect estimate compared to the direct estimate, however the CrIs do
overlap and both estimates are in the same direction and do not include
0. This indicates no evidence of inconsistency in the network
meta‐analysis. However, studies should be reviewed and sensitivity
analyses are advised.</p>
</div>
<div class="section level3">
<h3 id="step-3-class-effects-assessment">STEP 3: Class effects assessment<a class="anchor" aria-label="anchor" href="#step-3-class-effects-assessment"></a>
</h3>
<p>In this step, we assess whether a class assumption is suitable for
the data by comparing our NMA RE model with an exchangeable class model
with a RE treatment model. In this model, we specify
<code>class_effects = "exchangeable"</code>, meaning that treatments
within each class are considered to be from a common distribution. The
<code>prior_class_sd</code> sets a prior on the standard deviation
between treatment effects within each class. Because it is difficult to
estimate the class standard deviations with only a small number of
treatments in each class, here we specify an informative
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.33</mn><mo>,</mo><msup><mn>0.1</mn><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathrm{N}(0.33,0.1^2)</annotation></semantics></math>
prior distribution that is chosen to keep class variability within a
clinically-plausible range <span class="citation">(<a href="#ref-Perren2025">Perren et al., in preparation</a>)</span>. We
also define <code>class_sd</code> as a list of character vectors
indicating which classes share a common SD, again aiding estimation of
these parameters. For the class effects means,
<code>prior_class_mean</code> is set as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mn>10</mn><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathrm{N}(0, 10^2)</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sa_fit_EXclass_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">sa_net</span>,</span>
<span>                         trt_effects <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                         prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                         prior_het <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">half_normal</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>                         class_effects <span class="op">=</span> <span class="st">"exchangeable"</span>,</span>
<span>                         prior_class_mean <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                         prior_class_sd <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0.33</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                         class_sd <span class="op">=</span> </span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`Exercise and SH no support` <span class="op">=</span> </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Exercise promotion"</span>, <span class="st">"Self-help no support"</span><span class="op">)</span>,</span>
<span>                                `SSRIs and NSSA` <span class="op">=</span> </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SSRI/SNRI"</span>, <span class="st">"NSSA"</span><span class="op">)</span>,</span>
<span>                                `Psychodynamic &amp; Other psychological therapies` <span class="op">=</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Psychodynamic psychotherapy"</span>, <span class="st">"Other psychological therapies"</span><span class="op">)</span><span class="op">)</span></span>
<span>                         <span class="op">)</span></span></code></pre></div>
<p>We compare model fit from the Exchangeable class RE model and the no
class RE model using the <code><a href="../reference/dic.html">dic()</a></code> function and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sa_dic_EXclass_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">sa_fit_EXclass_RE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Residual deviance: 163.4<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 88.2</span></span>
<span><span class="co">#&gt;               DIC: 251.6</span></span>
<span><span class="op">(</span><span class="va">sa_dic_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">sa_fit_RE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Residual deviance: 162.6<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 94.3</span></span>
<span><span class="co">#&gt;               DIC: 256.9</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sa_fit_RE</span>, pars <span class="op">=</span> <span class="st">"tau"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     mean   sd 2.5%  25% 50%  75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; tau 0.21 0.03 0.15 0.18 0.2 0.23  0.27     1127     2095    1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sa_fit_EXclass_RE</span>, pars <span class="op">=</span> <span class="st">"tau"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     mean   sd 2.5%  25% 50%  75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; tau  0.2 0.03 0.14 0.18 0.2 0.22  0.26     1366     2407    1</span></span></code></pre></div>
<p>We use the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function that produces a “dev-dev”
plot of the residual deviance contributions for the Exchangeable class
model plotted against the no class model.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sa_dic_EXclass_RE</span>, <span class="va">sa_dic_RE</span>, show_uncertainty <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Residual deviance - Exchangeable Class model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Residual deviance - No Class model"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_social_anxiety_files/figure-html/unnamed-chunk-17-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Although both models yield similar residual deviance (163.4
vs. 162.6) and between‐study heterogeneity, the exchangeable class model
reduces model complexity—reflected by a lower effective number of
parameters ( vs. 94.3) and a lower DIC (251.6 vs. 256.9). A
deviance–deviance plot confirms that all data points fit equally well.
Overall, these findings support using the class model for the social
anxiety data.</p>
</div>
<div class="section level3">
<h3 id="step-4-class-model-assessment">STEP 4: Class Model Assessment<a class="anchor" aria-label="anchor" href="#step-4-class-model-assessment"></a>
</h3>
<p>After we have determined that a class effects model is appropriate,
it is time to finalise which combination of common or exchangeable class
effects and fixed or random treatment effects provides the most suitable
model fit. As we are using a random effects model, we now fit 2 other
models to our data; Exchangeable class FE and Common class RE. This
gives us a total of 3 models to compare. Exchangeable class FE,
Exchangeable class RE and Common class RE.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sa_fit_COclass_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">sa_net</span>,</span>
<span>                         trt_effects <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                         prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                         prior_het <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">half_normal</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>                         class_effects <span class="op">=</span> <span class="st">"common"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sa_fit_EXclass_FE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">sa_net</span>,</span>
<span>                         trt_effects <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                         prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                         prior_het <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">half_normal</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>                         class_effects <span class="op">=</span> <span class="st">"exchangeable"</span>,</span>
<span>                         prior_class_mean <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                         prior_class_sd <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0.33</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                         class_sd <span class="op">=</span> </span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`Exercise and SH no support` <span class="op">=</span> </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Exercise promotion"</span>, <span class="st">"Self-help no support"</span><span class="op">)</span>,</span>
<span>                                `SSRIs and NSSA` <span class="op">=</span> </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SSRI/SNRI"</span>, <span class="st">"NSSA"</span><span class="op">)</span>,</span>
<span>                                `Psychodynamic &amp; Other psychological therapies` <span class="op">=</span> </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Psychodynamic psychotherapy"</span>, <span class="st">"Other psychological therapies"</span><span class="op">)</span><span class="op">)</span></span>
<span>                         <span class="op">)</span></span></code></pre></div>
<p>We compare model fit from all three models using the
<code><a href="../reference/dic.html">dic()</a></code> function and evaluate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
in the common class RE model and the exchangeable class RE model.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sa_dic_COclass_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">sa_fit_COclass_RE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Residual deviance: 157.7<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 93</span></span>
<span><span class="co">#&gt;               DIC: 250.7</span></span>
<span><span class="op">(</span><span class="va">sa_dic_EXclass_FE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">sa_fit_EXclass_FE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Residual deviance: 284.9<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 34.4</span></span>
<span><span class="co">#&gt;               DIC: 319.3</span></span>
<span><span class="op">(</span><span class="va">sa_dic_EXclass_RE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">sa_fit_EXclass_RE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Residual deviance: 163.4<span style="color: #555555;"> (on 147 data points)</span></span></span>
<span><span class="co">#&gt;                pD: 88.2</span></span>
<span><span class="co">#&gt;               DIC: 251.6</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sa_fit_COclass_RE</span>, pars <span class="op">=</span> <span class="st">"tau"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     mean   sd 2.5%  25%  50%  75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; tau 0.25 0.03  0.2 0.23 0.25 0.27  0.31      842     1890    1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sa_fit_EXclass_RE</span>, pars <span class="op">=</span> <span class="st">"tau"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     mean   sd 2.5%  25% 50%  75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; tau  0.2 0.03 0.14 0.18 0.2 0.22  0.26     1366     2407    1</span></span></code></pre></div>
<p>Both random‐effects models showed substantially better fit than the
fixed‐effect model (posterior mean residual deviance of 157.7 and 163.4
versus 284.9, and DIC values of 250.7 and 251.6 versus 319.3). Although
the common class model achieved a slightly better absolute fit, it had
higher between‐study heterogeneity (0.25 vs. 0.20) than the exchangeable
class model. We use the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function to produce a
“dev-dev” plot of the residual deviance contributions for the
Exchangeable class model plotted against the no class model.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sa_dic_COclass_RE</span>, <span class="va">sa_dic_EXclass_RE</span>, show_uncertainty <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Residual deviance - Common Class model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Residual deviance - Exchangeable Class model"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_social_anxiety_files/figure-html/unnamed-chunk-20-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The dev–dev plot indicates that while some data points favor one
model over the other, overall the fit is similar. Therefore, given
nearly identical DIC scores, the choice between the two random‐effects
models should be guided by clinical considerations: use the exchangeable
class model if reporting distinct treatment‐level effects is important,
or the common class model if the focus is on class-level effects and not
concerned with potential variability of treatment effects within
classes.</p>
</div>
</div>
<div class="section level2">
<h2 id="results-for-final-chosen-model">Results for final chosen model<a class="anchor" aria-label="anchor" href="#results-for-final-chosen-model"></a>
</h2>
<div class="section level3">
<h3 id="relative-treatment-effects">Relative treatment effects<a class="anchor" aria-label="anchor" href="#relative-treatment-effects"></a>
</h3>
<p>Relative treatment effects are produced with the
<code><a href="../reference/relative_effects.html">relative_effects()</a></code> function, and can be plotted using
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/relative_effects.html">relative_effects</a></span><span class="op">(</span><span class="va">sa_fit_EXclass_RE</span><span class="op">)</span>, ref_line <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_social_anxiety_files/figure-html/unnamed-chunk-21-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="relative-class-effects">Relative class effects<a class="anchor" aria-label="anchor" href="#relative-class-effects"></a>
</h3>
<p>We can produce a plot showing relative class effects against
<code>Waitlist</code> using <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> with
<code>pars = "class_mean"</code> to select these parameters.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sa_fit_EXclass_RE</span>,</span>
<span>     pars <span class="op">=</span> <span class="st">"class_mean"</span>,</span>
<span>     ref_line <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_social_anxiety_files/figure-html/unnamed-chunk-22-1.png" width="700" style="display: block; margin: auto;"></p>
<p>We can combine the treatment and class effects into a single plot as
follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Relative treatment effects</span></span>
<span><span class="va">trt_eff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="../reference/relative_effects.html">relative_effects</a></span><span class="op">(</span><span class="va">sa_fit_EXclass_RE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add in class details</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Class <span class="op">=</span> <span class="va">sa_net</span><span class="op">$</span><span class="va">classes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.trtb</span><span class="op">)</span><span class="op">]</span>,</span>
<span>         level <span class="op">=</span> <span class="st">"treatment"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Class effects</span></span>
<span><span class="va">class_eff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sa_fit_EXclass_RE</span>, pars <span class="op">=</span> <span class="st">"class_mean"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Extract class details</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".*\\[(.+)\\]"</span>, <span class="st">"\\1"</span>, <span class="va">parameter</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">sa_net</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         level <span class="op">=</span> <span class="st">"class"</span>,</span>
<span>         .trtb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="st">"Class Mean"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">sa_net</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span>, <span class="st">"Class Mean"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine and plot</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">trt_eff</span>, <span class="va">class_eff</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.trtb</span>, </span>
<span>             x <span class="op">=</span> <span class="va">mean</span>, xmin <span class="op">=</span> <span class="va">`2.5%`</span>, xmax <span class="op">=</span> <span class="va">`97.5%`</span>,</span>
<span>             colour <span class="op">=</span> <span class="va">level</span>, shape <span class="op">=</span> <span class="va">level</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, colour <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="st">"Class"</span>, scales <span class="op">=</span> <span class="st">"free"</span>, space <span class="op">=</span> <span class="st">"free"</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_wrap_gen</a></span><span class="op">(</span><span class="fl">22</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span><span class="op">)</span>, guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_none.html" class="external-link">guide_none</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#113259"</span>, <span class="st">"#55A480"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_none.html" class="external-link">guide_none</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"SMD"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_multinma.html">theme_multinma</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_social_anxiety_files/figure-html/unnamed-chunk-23-1.png" width="700" style="display: block; margin: auto;"></p>
<p>We aim to visualize the class ranks and rank probabilities by
summarizing their distributions. To achieve this, we extract the
posterior draws for class means, add a reference treatment, and compute
the rank of each treatment at every iteration. We then summarize these
ranks by calculating the median and 95% credible intervals to generate a
point-range plot and derive the rank probability distributions for each
treatment class, which we then plot.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Class means</span></span>
<span><span class="va">EXclass_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">sa_fit_EXclass_RE</span>, pars <span class="op">=</span> <span class="st">"class_mean"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">EXclass_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>`d[Reference]` <span class="op">=</span> <span class="fl">0</span>, <span class="va">EXclass_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take ranks at each iteration</span></span>
<span><span class="va">EXranks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">EXclass_mean</span>, <span class="fl">1</span>, <span class="va">rank</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get median rank and 95% credible interval</span></span>
<span><span class="va">EXresults</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">EXranks</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to data frame</span></span>
<span><span class="va">EXresults_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">EXresults</span><span class="op">)</span></span>
<span><span class="va">EXresults_df</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">EXresults_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">EXresults_df</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">EXresults_df</span><span class="op">$</span><span class="va">class</span>, </span>
<span>                             levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">EXresults_df</span><span class="op">$</span><span class="va">class</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">EXresults_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">class</span>, y<span class="op">=</span><span class="va">`50%`</span>, ymin<span class="op">=</span><span class="va">`2.5%`</span>, ymax<span class="op">=</span><span class="va">`97.5%`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Class"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Posterior Ranks"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/theme_multinma.html">theme_multinma</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_social_anxiety_files/figure-html/unnamed-chunk-24-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Treatment classes with higher ranks have median values closer to 1,
positioned toward the left of the x-axis. The Combined treatment class
has the highest median rank, followed by CBT individual. In contrast,
Exercise promotion appears to have the lowest rank among the treatment
classes, aside from the reference.</p>
<p>We now calculate and plot the class rank probabilities.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EXranks_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">EXranks</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rank probabilities for class</span></span>
<span><span class="va">rank_probs_EX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">EXranks_df</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">x</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">EXranks_df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">EXranks_df</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to data frame</span></span>
<span><span class="va">rank_probs_df_EX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rank_probs_EX</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert the data frame to a long format</span></span>
<span><span class="va">rank_probs_long_EX</span> <span class="op">&lt;-</span> <span class="va">rank_probs_df_EX</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Rank <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="op">-</span><span class="va">Rank</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"Class"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"Probability"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot density</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rank_probs_long_EX</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Rank</span>, y <span class="op">=</span> <span class="va">Probability</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Class</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_multinma.html">theme_multinma</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Rank"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_social_anxiety_files/figure-html/unnamed-chunk-25-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Higher-ranked classes have a greater density on the left side of the
x-axis, indicating a higher probability of achieving a top rank across
posterior samples. The Combined class shows the highest density on the
left, suggesting it is most likely to be ranked among the top
treatments, followed by CBT individual. In contrast, most other classes
have relatively flat distributions, reflecting greater uncertainty in
their rankings. Exercise promotion, Other psychological therapies, and
the reference class have densities skewed toward the right, indicating a
higher probability of lower rankings.</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-mayo2014psychological" class="csl-entry">
Mayo-Wilson, Evan, Sofia Dias, Ifigeneia Mavranezouli, Kayleigh Kew,
David M Clark, AE Ades, and Stephen Pilling. 2014. <span>“Psychological
and Pharmacological Interventions for Social Anxiety Disorder in Adults:
A Systematic Review and Network Meta-Analysis.”</span> <em>The Lancet
Psychiatry</em> 1 (5): 368–76.
</div>
<div id="ref-Perren2025" class="csl-entry">
Perren, S. J., H. Pedder, N. J. Welton, and D. M. Phillippo. In
preparation. <span>“Network Meta-Analysis with Class Effects: A
Practical Guide and Model Selection Algorithm.”</span>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David M. Phillippo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>



  <script data-goatcounter="https://multinma.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
