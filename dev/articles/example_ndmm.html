<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="multinma">
<title>Example: Newly diagnosed multiple myeloma • multinma</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Example: Newly diagnosed multiple myeloma">
<meta property="og:description" content="multinma">
<meta property="og:image" content="https://dmphillippo.github.io/multinma/logo.svg">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">multinma</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.5.1.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette_overview.html">Overview of Examples</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Examples</h6>
    <a class="dropdown-item" href="../articles/example_atrial_fibrillation.html">Example: Atrial fibrillation</a>
    <a class="dropdown-item" href="../articles/example_bcg_vaccine.html">Example: BCG vaccine for tuberculosis</a>
    <a class="dropdown-item" href="../articles/example_blocker.html">Example: Beta blockers</a>
    <a class="dropdown-item" href="../articles/example_diabetes.html">Example: Diabetes</a>
    <a class="dropdown-item" href="../articles/example_dietary_fat.html">Example: Dietary fat</a>
    <a class="dropdown-item" href="../articles/example_hta_psoriasis.html">Example: Plaque psoriasis HTA report</a>
    <a class="dropdown-item" href="../articles/example_ndmm.html">Example: Newly diagnosed multiple myeloma</a>
    <a class="dropdown-item" href="../articles/example_parkinsons.html">Example: Parkinson's disease</a>
    <a class="dropdown-item" href="../articles/example_plaque_psoriasis.html">Example: Plaque psoriasis ML-NMR</a>
    <a class="dropdown-item" href="../articles/example_smoking.html">Example: Smoking cessation</a>
    <a class="dropdown-item" href="../articles/example_statins.html">Example: Statins for cholesterol lowering</a>
    <a class="dropdown-item" href="../articles/example_thrombolytics.html">Example: Thrombolytic treatments</a>
    <a class="dropdown-item" href="../articles/example_transfusion.html">Example: White blood cell transfusion</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dmphillippo/multinma/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Example: Newly diagnosed multiple myeloma</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dmphillippo/multinma/blob/HEAD/vignettes/example_ndmm.Rmd" class="external-link"><code>vignettes/example_ndmm.Rmd</code></a></small>
      <div class="d-none name"><code>example_ndmm.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dmphillippo.github.io/multinma/">multinma</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="co">#&gt; options(mc.cores = parallel::detectCores())</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'multinma'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     dgamma, pgamma, qgamma</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/loo/" class="external-link">loo</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is loo version 2.6.0</span></span>
<span><span class="co">#&gt; - Online documentation and vignettes at mc-stan.org/loo</span></span>
<span><span class="co">#&gt; - As of v2.0.0 loo defaults to 1 core but we recommend using as many as possible. Use the 'cores' argument or set options(mc.cores = NUM_CORES) for an entire session.</span></span>
<span><span class="co">#&gt; - Windows 10 users: loo may be very slow if 'mc.cores' is set in your .Rprofile file (see https://github.com/stan-dev/loo/issues/94).</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><span class="citation">Leahy and Walsh (<a href="#ref-Leahy2019" role="doc-biblioref">2019</a>)</span> present a network of five trials
comparing lenalidomide and thalidomide to placebo for newly diagnosed
multiple myeloma (NDMM) after autologous stem cell transplant (ASCT).
The outcome of interest is progression free survival (PFS). Simulated
individual patient data (IPD) from three trials are found in the data
set <code>ndmm_ipd</code>. These include outcome times, censoring
indicators, and covariates for each individual:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ndmm_ipd</span><span class="op">)</span></span>
<span><span class="co">#&gt;          study trt       studyf trtf      age iss_stage3 response_cr_vgpr male eventtime status</span></span>
<span><span class="co">#&gt; 1 McCarthy2012 Pbo McCarthy2012  Pbo 50.81625          0                1    0 31.106516      1</span></span>
<span><span class="co">#&gt; 2 McCarthy2012 Pbo McCarthy2012  Pbo 62.18165          0                0    0  3.299623      0</span></span>
<span><span class="co">#&gt; 3 McCarthy2012 Pbo McCarthy2012  Pbo 51.53762          1                1    1 57.400000      0</span></span>
<span><span class="co">#&gt; 4 McCarthy2012 Pbo McCarthy2012  Pbo 46.74128          0                1    1 57.400000      0</span></span>
<span><span class="co">#&gt; 5 McCarthy2012 Pbo McCarthy2012  Pbo 62.62561          0                1    1 57.400000      0</span></span>
<span><span class="co">#&gt; 6 McCarthy2012 Pbo McCarthy2012  Pbo 49.24520          1                1    0 30.714460      0</span></span></code></pre></div>
<p>Aggregate data (AgD) consisting of reconstructed event/censoring
times from digitized Kaplan-Meier curves and covariate summaries are
available on a further two trials, found in the data sets
<code>ndmm_agd</code> and <code>ndmm_agd_covs</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ndmm_agd</span><span class="op">)</span></span>
<span><span class="co">#&gt;        study     studyf trt trtf eventtime status</span></span>
<span><span class="co">#&gt; 1 Morgan2012 Morgan2012 Pbo  Pbo  18.72575      1</span></span>
<span><span class="co">#&gt; 2 Morgan2012 Morgan2012 Pbo  Pbo  63.36000      0</span></span>
<span><span class="co">#&gt; 3 Morgan2012 Morgan2012 Pbo  Pbo  34.35726      1</span></span>
<span><span class="co">#&gt; 4 Morgan2012 Morgan2012 Pbo  Pbo  10.77826      1</span></span>
<span><span class="co">#&gt; 5 Morgan2012 Morgan2012 Pbo  Pbo  63.36000      0</span></span>
<span><span class="co">#&gt; 6 Morgan2012 Morgan2012 Pbo  Pbo  14.52966      1</span></span>
<span></span>
<span><span class="va">ndmm_agd_covs</span></span>
<span><span class="co">#&gt;         study      studyf  trt trtf sample_size  age_min age_iqr_l age_median age_iqr_h  age_max</span></span>
<span><span class="co">#&gt; 1 Jackson2019 Jackson2019  Len  Len        1137 17.28246  59.13164   65.76766  72.00756 85.76095</span></span>
<span><span class="co">#&gt; 2 Jackson2019 Jackson2019  Pbo  Pbo         864 21.18572  58.30991   65.47402  71.80261 86.23080</span></span>
<span><span class="co">#&gt; 3  Morgan2012  Morgan2012  Pbo  Pbo         410 33.88979  58.05696   64.15999  70.44791 84.79372</span></span>
<span><span class="co">#&gt; 4  Morgan2012  Morgan2012 Thal Thal         408 38.45127  59.30022   65.48736  71.73597 84.69365</span></span>
<span><span class="co">#&gt;   age_mean   age_sd iss_stage3 response_cr_vgpr      male</span></span>
<span><span class="co">#&gt; 1 65.16867 8.936962  0.2480211        0.8258575 0.6165347</span></span>
<span><span class="co">#&gt; 2 64.62894 9.399272  0.1921296        0.8310185 0.6215278</span></span>
<span><span class="co">#&gt; 3 63.92360 9.006311  0.3634146        0.7170732 0.6195122</span></span>
<span><span class="co">#&gt; 4 65.59387 8.384686  0.3186275        0.7450980 0.6151961</span></span></code></pre></div>
<p><span class="citation">Phillippo et al. (<a href="#ref-Phillippo_survival" role="doc-biblioref">n.d.</a>)</span>
analysed these data using multilevel network meta-regression (ML-NMR),
and we recreate these analyses here.</p>
<div class="section level2">
<h2 id="study-data">Study data<a class="anchor" aria-label="anchor" href="#study-data"></a>
</h2>
<p>First, let us look at Kaplan-Meier plots of the data from each
study:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ndmm_ipd</span>, <span class="va">ndmm_agd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">studyf</span>, <span class="va">trtf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># KM estimate within each study</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_modify</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">eventtime</span>, event <span class="op">=</span> <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">n.censor</span>, estimate <span class="op">=</span> <span class="va">surv</span>, <span class="va">std.err</span>, <span class="va">upper</span>, <span class="va">lower</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add S(0) = 1</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_modify</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span><span class="va">.</span>, time <span class="op">=</span> <span class="fl">0</span>, n.censor <span class="op">=</span> <span class="fl">0</span>, estimate <span class="op">=</span> <span class="fl">1</span>, std.err <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">1</span>, lower <span class="op">=</span> <span class="fl">1</span>, .before <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">studyf</span>, <span class="va">trtf</span>, <span class="va">time</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">kmdat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">estimate</span>, colour <span class="op">=</span> <span class="va">trtf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">3</span>, data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n.censor</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">studyf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Survival probability"</span>, x <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_multinma.html">theme_multinma</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/ndmm-km-data-1.png" style="display: block; margin: auto;"></p>
<p>We consider adjustment for the following covariates:</p>
<ul>
<li>Age</li>
<li>Sex</li>
<li>ISS stage, I-II vs. III</li>
<li>Response post-ASCT, complete or very good partial response
vs. lesser response</li>
</ul>
<p>The summary distributions of these characteristics in each study are
as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">ndmm_ipd</span>,</span>
<span>            N <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            age_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, age_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span>
<span>            iss_stage3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">iss_stage3</span><span class="op">)</span>,</span>
<span>            response_cr_vgpr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">response_cr_vgpr</span><span class="op">)</span>,</span>
<span>            male <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">male</span><span class="op">)</span>,</span>
<span>            .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">studyf</span>, <span class="va">trtf</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span><span class="va">ndmm_agd_covs</span>,</span>
<span>            <span class="va">studyf</span>, <span class="va">trtf</span>,</span>
<span>            N <span class="op">=</span> <span class="va">sample_size</span>,</span>
<span>            <span class="va">age_mean</span>, <span class="va">age_sd</span>, <span class="va">iss_stage3</span>, <span class="va">response_cr_vgpr</span>, <span class="va">male</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.double</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;          studyf trtf    N age_mean age_sd iss_stage3 response_cr_vgpr male</span></span>
<span><span class="co">#&gt; 1  McCarthy2012  Pbo  229    57.39   5.56       0.18             0.71 0.55</span></span>
<span><span class="co">#&gt; 2  McCarthy2012  Len  231    57.93   6.33       0.27             0.62 0.52</span></span>
<span><span class="co">#&gt; 3     Attal2012  Pbo  307    54.22   5.24       0.16             0.54 0.58</span></span>
<span><span class="co">#&gt; 4     Attal2012  Len  307    54.35   6.06       0.24             0.55 0.55</span></span>
<span><span class="co">#&gt; 5   Palumbo2014  Pbo  125    54.44   8.98       0.12             0.38 0.63</span></span>
<span><span class="co">#&gt; 6   Palumbo2014  Len  126    53.90   9.69       0.10             0.42 0.46</span></span>
<span><span class="co">#&gt; 7   Jackson2019  Len 1137    65.17   8.94       0.25             0.83 0.62</span></span>
<span><span class="co">#&gt; 8   Jackson2019  Pbo  864    64.63   9.40       0.19             0.83 0.62</span></span>
<span><span class="co">#&gt; 9    Morgan2012  Pbo  410    63.92   9.01       0.36             0.72 0.62</span></span>
<span><span class="co">#&gt; 10   Morgan2012 Thal  408    65.59   8.38       0.32             0.75 0.62</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="section level3">
<h3 id="preparing-treatment-classes">Preparing treatment classes<a class="anchor" aria-label="anchor" href="#preparing-treatment-classes"></a>
</h3>
<p>We start by setting up the network for the analysis. Since we only
have IPD on the placebo vs. lenalidomide comparison, and only one AgD
study on the placebo vs. thalidomide comparison, we make the shared
effect modifier assumption between the two active treatments in order to
estimate the effect modifying treatment-covariate interactions for
thalidomide <span class="citation">Phillippo et al. (<a href="#ref-methods_paper" role="doc-biblioref">2020</a>)</span>. Since
lenalidomide and thalidomide are both in the same class of treatments,
this assumption may be reasonable.</p>
<p>To impose this assumption, we create a treatment class variable for
active treatments vs. placebo.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndmm_ipd</span><span class="op">$</span><span class="va">trtclass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">ndmm_ipd</span><span class="op">$</span><span class="va">trtf</span>,</span>
<span>                                <span class="st">"Pbo"</span> <span class="op">~</span> <span class="st">"Placebo"</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Len"</span>, <span class="st">"Thal"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Active"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ndmm_agd</span><span class="op">$</span><span class="va">trtclass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">ndmm_agd</span><span class="op">$</span><span class="va">trtf</span>,</span>
<span>                                <span class="st">"Pbo"</span> <span class="op">~</span> <span class="st">"Placebo"</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Len"</span>, <span class="st">"Thal"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Active"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="setting-up-the-network">Setting up the network<a class="anchor" aria-label="anchor" href="#setting-up-the-network"></a>
</h3>
<p>We then set up the network using the <code><a href="../reference/set_ipd.html">set_ipd()</a></code>,
<code><a href="../reference/set_agd_surv.html">set_agd_surv()</a></code>, and <code><a href="../reference/combine_network.html">combine_network()</a></code>
functions. Since we have survival data in the form of event/censoring
times and censoring indicators, we use the <code>Surv</code> argument to
the <code>set_*()</code> functions to set up the outcome data using the
usual <code><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">survival::Surv()</a></code> function. The AgD are set up in a
similar fashion to the IPD, except that we only have summary covariate
information (in the data frame <code>ndmm_agd_covs</code>) which is
included using the <code>covariates</code> argument. The data frame
passed to <code>covariates</code> must have matching study and treatment
columns to the outcome data set (<code>ndmm_agd</code>), in this case
<code>studyf</code> and <code>trtf</code> respectively, one row per arm,
so that the covariate information can be matched to the corresponding
arms in the outcome data. The IPD and AgD are then combined into a
single network using <code><a href="../reference/combine_network.html">combine_network()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndmm_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine_network.html">combine_network</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/set_ipd.html">set_ipd</a></span><span class="op">(</span><span class="va">ndmm_ipd</span>,</span>
<span>          study <span class="op">=</span> <span class="va">studyf</span>,</span>
<span>          trt <span class="op">=</span> <span class="va">trtf</span>,</span>
<span>          trt_class <span class="op">=</span> <span class="va">trtclass</span>,</span>
<span>          Surv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">eventtime</span>, <span class="va">status</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/set_agd_surv.html">set_agd_surv</a></span><span class="op">(</span><span class="va">ndmm_agd</span>,</span>
<span>               study <span class="op">=</span> <span class="va">studyf</span>,</span>
<span>               trt <span class="op">=</span> <span class="va">trtf</span>,</span>
<span>               trt_class <span class="op">=</span> <span class="va">trtclass</span>,</span>
<span>               Surv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">eventtime</span>, <span class="va">status</span><span class="op">)</span>,</span>
<span>               covariates <span class="op">=</span> <span class="va">ndmm_agd_covs</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-numerical-integration-for-ml-nmr">Adding numerical integration for ML-NMR<a class="anchor" aria-label="anchor" href="#adding-numerical-integration-for-ml-nmr"></a>
</h3>
<p>To perform ML-NMR, we need to create numerical integration points for
the joint covariate distributions in each AgD study. These are used to
integrate (i.e. average) the individual-level model over the joint
covariate distribution to form the aggregate-level model. This is done
using the <code><a href="../reference/add_integration.html">add_integration()</a></code> function, and for each
covariate we specify the marginal distribution using the
<code><a href="../reference/distr.html">distr()</a></code> function. Since age is skewed, we use a gamma
distribution for this covariate; the remaining covariates are all binary
and so are given Bernoulli distributions. This procedure also requires
information on the correlations between covariates. If known, these can
be specified using the <code>cor</code> argument. However, by default
the weighted average correlations from the IPD studies will be used.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndmm_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_integration.html">add_integration</a></span><span class="op">(</span><span class="va">ndmm_net</span>,</span>
<span>                            age <span class="op">=</span> <span class="fu"><a href="../reference/distr.html">distr</a></span><span class="op">(</span><span class="va">qgamma</span>, mean <span class="op">=</span> <span class="va">age_mean</span>, sd <span class="op">=</span> <span class="va">age_sd</span><span class="op">)</span>,</span>
<span>                            iss_stage3 <span class="op">=</span> <span class="fu"><a href="../reference/distr.html">distr</a></span><span class="op">(</span><span class="va">qbern</span>, <span class="va">iss_stage3</span><span class="op">)</span>,</span>
<span>                            response_cr_vgpr <span class="op">=</span> <span class="fu"><a href="../reference/distr.html">distr</a></span><span class="op">(</span><span class="va">qbern</span>, <span class="va">response_cr_vgpr</span><span class="op">)</span>,</span>
<span>                            male <span class="op">=</span> <span class="fu"><a href="../reference/distr.html">distr</a></span><span class="op">(</span><span class="va">qbern</span>, <span class="va">male</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using weighted average correlation matrix computed from IPD studies.</span></span>
<span></span>
<span><span class="va">ndmm_net</span></span>
<span><span class="co">#&gt; A network with 3 IPD studies, and 2 AgD studies (arm-based).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------------- IPD studies ---- </span></span>
<span><span class="co">#&gt;  Study        Treatment arms</span></span>
<span><span class="co">#&gt;  Attal2012    2: Pbo | Len  </span></span>
<span><span class="co">#&gt;  McCarthy2012 2: Pbo | Len  </span></span>
<span><span class="co">#&gt;  Palumbo2014  2: Pbo | Len  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Outcome type: survival</span></span>
<span><span class="co">#&gt; ------------------------------------------------------- AgD studies (arm-based) ---- </span></span>
<span><span class="co">#&gt;  Study       Treatment arms</span></span>
<span><span class="co">#&gt;  Jackson2019 2: Pbo | Len  </span></span>
<span><span class="co">#&gt;  Morgan2012  2: Pbo | Thal </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Outcome type: survival</span></span>
<span><span class="co">#&gt; ------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Total number of treatments: 3, in 2 classes</span></span>
<span><span class="co">#&gt; Total number of studies: 5</span></span>
<span><span class="co">#&gt; Reference treatment is: Pbo</span></span>
<span><span class="co">#&gt; Network is connected</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------------------------------- Numerical integration ---- </span></span>
<span><span class="co">#&gt; Numerical integration points available for 4 covariates: </span></span>
<span><span class="co">#&gt;   age iss_stage3 response_cr_vgpr male</span></span>
<span><span class="co">#&gt; Number of numerical integration points: 64</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="network-plot">Network plot<a class="anchor" aria-label="anchor" href="#network-plot"></a>
</h3>
<p>We can plot the network diagram using the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
method.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ndmm_net</span>,</span>
<span>    weight_nodes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    weight_edges <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="co"># Nudge treatment labels away from nodes</span></span>
<span>    nudge <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    <span class="co"># Manual layout</span></span>
<span>    layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>edge_colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>edge_width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.direction <span class="op">=</span> <span class="st">"vertical"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/ndmm-network-1.png" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="ml-nmr-models-with-m-spline-baseline-hazards">ML-NMR models with M-spline baseline hazards<a class="anchor" aria-label="anchor" href="#ml-nmr-models-with-m-spline-baseline-hazards"></a>
</h2>
<p>We fit a proportional hazards survival model with cubic M-splines on
the baseline hazard <span class="citation">Phillippo et al. (<a href="#ref-Phillippo_survival" role="doc-biblioref">n.d.</a>)</span>.
This allows the baseline hazard to flexibly follow any shape that the
baseline hazard may take.</p>
<div class="section level3">
<h3 id="choosing-the-number-of-knots">Choosing the number of knots<a class="anchor" aria-label="anchor" href="#choosing-the-number-of-knots"></a>
</h3>
<p>ML-NMR models are fit using the <code><a href="../reference/nma.html">nma()</a></code> function, and we
specify that a M-spline baseline hazard should be used with
<code>likelihood = "mspline"</code>.</p>
<p>Fitting spline models requires the user to specify the number and
location of the knots. By default, three internal knots are used
(<code>n_knots = 3</code>) which are placed at evenly spaced quantiles
on the observed event times within each study (i.e. at the 25%, 50%, and
75% quantiles with 3 internal knots). The number of knots can be changed
using the <code>n_knots</code> argument, or custom knot locations can be
specified using the <code>knots</code> argument. The <code><a href="../reference/nma.html">nma()</a></code>
function will always place boundary knots at the earliest entry time
into the study (0 with no delayed entry) and at the maximum
event/censoring time.</p>
<p>By default, the <code><a href="../reference/nma.html">nma()</a></code> function will fit a cubic M-spline
(<code>mspline_degree = 3</code>). Piecewise-constant hazards
(i.e. piecewise exponential hazards) are a special case with degree 0
splines, specified using <code>likelihood = "pexp"</code> (which is
equivalent to <code>mspline_degree = 0</code>).</p>
<p>We specify a regression model using the <code>regression</code>
argument which includes main effects of covariates (prognostic effects)
and treatment-covariate interactions (effect modifier interactions) for
each covariate. We place vague <span class="math inline">\(\operatorname{N}(0, 100^2)\)</span> priors on each
of the parameters in the linear predictor, and a <span class="math inline">\(\operatorname{Dirichlet}(1)\)</span> prior
distribution for the spline coefficients which is uniform over the unit
simplex. Using the QR decomposition (<code>QR = TRUE</code>) can greatly
increase sampling efficiency for regression models, and we also reduce
the <code>max_treedepth</code> of the Stan sampler to speed up warm-up
time.</p>
<p>We fit models with 1, 2, and 3 internal knots, and we will then
choose the number of knots using the leave-one-out information criterion
(LOOIC).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndmm_fit_1kt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">ndmm_net</span>,</span>
<span>                    regression <span class="op">=</span> <span class="op">~</span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="va">iss_stage3</span> <span class="op">+</span> <span class="va">response_cr_vgpr</span> <span class="op">+</span> <span class="va">male</span><span class="op">)</span><span class="op">*</span><span class="va">.trt</span>,</span>
<span>                    likelihood <span class="op">=</span> <span class="st">"mspline"</span>,</span>
<span>                    n_knots <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    prior_intercept <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_reg <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_aux <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">dirichlet</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                    QR <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    <span class="co"># Reducing max_treedepth can speed up warm-up, but</span></span>
<span>                    <span class="co"># increase if max_treedepth errors occur</span></span>
<span>                    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_treedepth <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: Setting "Pbo" as the network reference treatment.</span></span>
<span></span>
<span><span class="va">ndmm_fit_1kt</span></span>
<span><span class="co">#&gt; A fixed effects ML-NMR with a mspline likelihood (log link).</span></span>
<span><span class="co">#&gt; Regression model: ~(age + iss_stage3 + response_cr_vgpr + male) * .trt.</span></span>
<span><span class="co">#&gt; Centred covariates at the following overall mean values:</span></span>
<span><span class="co">#&gt;              age       iss_stage3 response_cr_vgpr             male </span></span>
<span><span class="co">#&gt;       61.6558571        0.2297184        0.7314265        0.6020451 </span></span>
<span><span class="co">#&gt; Inference for Stan model: survival_mspline.</span></span>
<span><span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                             mean se_mean   sd      2.5%       25%       50%</span></span>
<span><span class="co">#&gt; beta[age]                                   0.08    0.00 0.01      0.06      0.07      0.08</span></span>
<span><span class="co">#&gt; beta[iss_stage3]                            0.36    0.00 0.13      0.09      0.27      0.36</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr]                     -0.14    0.00 0.10     -0.33     -0.20     -0.14</span></span>
<span><span class="co">#&gt; beta[male]                                  0.01    0.00 0.10     -0.19     -0.06      0.01</span></span>
<span><span class="co">#&gt; beta[age:.trtclassActive]                  -0.02    0.00 0.01     -0.03     -0.02     -0.02</span></span>
<span><span class="co">#&gt; beta[iss_stage3:.trtclassActive]            0.20    0.00 0.17     -0.14      0.08      0.20</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr:.trtclassActive]      0.20    0.00 0.14     -0.07      0.10      0.20</span></span>
<span><span class="co">#&gt; beta[male:.trtclassActive]                  0.13    0.00 0.15     -0.17      0.03      0.13</span></span>
<span><span class="co">#&gt; d[Len]                                     -0.67    0.00 0.05     -0.77     -0.71     -0.67</span></span>
<span><span class="co">#&gt; d[Thal]                                    -0.20    0.00 0.11     -0.42     -0.27     -0.20</span></span>
<span><span class="co">#&gt; lp__                                   -12422.83    0.12 4.54 -12432.71 -12425.68 -12422.41</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 1]                         0.03    0.00 0.01      0.01      0.02      0.03</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 2]                         0.18    0.00 0.05      0.07      0.14      0.17</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 3]                         0.38    0.00 0.10      0.19      0.32      0.38</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 4]                         0.20    0.00 0.09      0.03      0.13      0.19</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 5]                         0.22    0.00 0.05      0.13      0.19      0.22</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 1]                      0.01    0.00 0.01      0.00      0.00      0.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 2]                      0.28    0.00 0.04      0.20      0.25      0.28</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 3]                      0.17    0.00 0.09      0.02      0.10      0.16</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 4]                      0.31    0.00 0.11      0.08      0.23      0.31</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 5]                      0.23    0.00 0.07      0.09      0.18      0.23</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 1]                       0.01    0.00 0.01      0.00      0.00      0.01</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 2]                       0.39    0.00 0.07      0.26      0.34      0.39</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 3]                       0.20    0.00 0.11      0.02      0.12      0.20</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 4]                       0.18    0.00 0.11      0.01      0.09      0.17</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 5]                       0.21    0.00 0.08      0.06      0.15      0.21</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 1]                       0.04    0.00 0.01      0.03      0.03      0.04</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 2]                       0.32    0.00 0.03      0.25      0.29      0.32</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 3]                       0.23    0.00 0.06      0.11      0.18      0.23</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 4]                       0.22    0.00 0.07      0.09      0.18      0.22</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 5]                       0.20    0.00 0.04      0.12      0.17      0.20</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 1]                        0.02    0.00 0.01      0.01      0.02      0.02</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 2]                        0.45    0.00 0.04      0.37      0.43      0.45</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 3]                        0.10    0.00 0.07      0.00      0.05      0.09</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 4]                        0.34    0.00 0.08      0.16      0.29      0.35</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 5]                        0.08    0.00 0.05      0.01      0.04      0.08</span></span>
<span><span class="co">#&gt;                                              75%     97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; beta[age]                                   0.08      0.09  4125 1.00</span></span>
<span><span class="co">#&gt; beta[iss_stage3]                            0.45      0.60  8460 1.00</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr]                     -0.07      0.06  7319 1.00</span></span>
<span><span class="co">#&gt; beta[male]                                  0.07      0.21  9061 1.00</span></span>
<span><span class="co">#&gt; beta[age:.trtclassActive]                  -0.01      0.00  4984 1.00</span></span>
<span><span class="co">#&gt; beta[iss_stage3:.trtclassActive]            0.32      0.54 10231 1.00</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr:.trtclassActive]      0.30      0.48  6680 1.00</span></span>
<span><span class="co">#&gt; beta[male:.trtclassActive]                  0.23      0.43  6211 1.00</span></span>
<span><span class="co">#&gt; d[Len]                                     -0.63     -0.56  4645 1.00</span></span>
<span><span class="co">#&gt; d[Thal]                                    -0.13      0.01  4208 1.01</span></span>
<span><span class="co">#&gt; lp__                                   -12419.56 -12415.14  1403 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 1]                         0.04      0.06  3835 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 2]                         0.21      0.28  3107 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 3]                         0.45      0.57  2743 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 4]                         0.26      0.39  2986 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 5]                         0.25      0.31  3693 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 1]                      0.01      0.02  6817 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 2]                      0.31      0.37  3650 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 3]                      0.24      0.36  2881 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 4]                      0.39      0.52  2946 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 5]                      0.28      0.38  3514 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 1]                       0.02      0.04  5219 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 2]                       0.44      0.53  4516 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 3]                       0.27      0.41  3449 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 4]                       0.27      0.42  3763 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 5]                       0.27      0.38  4682 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 1]                       0.04      0.05  1789 1.01</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 2]                       0.34      0.38  3085 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 3]                       0.27      0.35  2521 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 4]                       0.27      0.35  2601 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 5]                       0.22      0.27  3485 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 1]                        0.03      0.04  6058 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 2]                        0.49      0.54  3772 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 3]                        0.14      0.26  3793 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 4]                        0.40      0.48  4936 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 5]                        0.11      0.18  5093 1.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Fri Aug 25 18:49:17 2023.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span>
<span></span>
<span><span class="va">ndmm_fit_2kt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">ndmm_net</span>,</span>
<span>                    regression <span class="op">=</span> <span class="op">~</span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="va">iss_stage3</span> <span class="op">+</span> <span class="va">response_cr_vgpr</span> <span class="op">+</span> <span class="va">male</span><span class="op">)</span><span class="op">*</span><span class="va">.trt</span>,</span>
<span>                    likelihood <span class="op">=</span> <span class="st">"mspline"</span>,</span>
<span>                    n_knots <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    prior_intercept <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_reg <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_aux <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">dirichlet</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                    QR <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    <span class="co"># Reducing max_treedepth can speed up warm-up, but</span></span>
<span>                    <span class="co"># increase if max_treedepth errors occur</span></span>
<span>                    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_treedepth <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: Setting "Pbo" as the network reference treatment.</span></span>
<span></span>
<span><span class="va">ndmm_fit_2kt</span></span>
<span><span class="co">#&gt; A fixed effects ML-NMR with a mspline likelihood (log link).</span></span>
<span><span class="co">#&gt; Regression model: ~(age + iss_stage3 + response_cr_vgpr + male) * .trt.</span></span>
<span><span class="co">#&gt; Centred covariates at the following overall mean values:</span></span>
<span><span class="co">#&gt;              age       iss_stage3 response_cr_vgpr             male </span></span>
<span><span class="co">#&gt;       61.6558571        0.2297184        0.7314265        0.6020451 </span></span>
<span><span class="co">#&gt; Inference for Stan model: survival_mspline.</span></span>
<span><span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                             mean se_mean   sd      2.5%       25%       50%</span></span>
<span><span class="co">#&gt; beta[age]                                   0.08    0.00 0.01      0.06      0.07      0.08</span></span>
<span><span class="co">#&gt; beta[iss_stage3]                            0.35    0.00 0.13      0.08      0.26      0.35</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr]                     -0.13    0.00 0.10     -0.33     -0.20     -0.13</span></span>
<span><span class="co">#&gt; beta[male]                                  0.01    0.00 0.10     -0.20     -0.07      0.01</span></span>
<span><span class="co">#&gt; beta[age:.trtclassActive]                  -0.02    0.00 0.01     -0.03     -0.02     -0.02</span></span>
<span><span class="co">#&gt; beta[iss_stage3:.trtclassActive]            0.20    0.00 0.18     -0.15      0.07      0.20</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr:.trtclassActive]      0.20    0.00 0.14     -0.07      0.11      0.20</span></span>
<span><span class="co">#&gt; beta[male:.trtclassActive]                  0.13    0.00 0.15     -0.16      0.03      0.13</span></span>
<span><span class="co">#&gt; d[Len]                                     -0.67    0.00 0.05     -0.77     -0.70     -0.67</span></span>
<span><span class="co">#&gt; d[Thal]                                    -0.20    0.00 0.11     -0.40     -0.27     -0.20</span></span>
<span><span class="co">#&gt; lp__                                   -12438.01    0.14 4.81 -12448.46 -12441.00 -12437.62</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 1]                         0.02    0.00 0.01      0.00      0.01      0.01</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 2]                         0.11    0.00 0.03      0.05      0.08      0.11</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 3]                         0.21    0.00 0.07      0.08      0.16      0.21</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 4]                         0.39    0.00 0.08      0.22      0.34      0.39</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 5]                         0.10    0.00 0.06      0.00      0.05      0.09</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 6]                         0.19    0.00 0.04      0.11      0.16      0.19</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 1]                      0.00    0.00 0.00      0.00      0.00      0.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 2]                      0.12    0.00 0.03      0.07      0.10      0.12</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 3]                      0.20    0.00 0.07      0.07      0.15      0.19</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 4]                      0.30    0.00 0.09      0.11      0.24      0.30</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 5]                      0.17    0.00 0.10      0.02      0.09      0.16</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 6]                      0.21    0.00 0.07      0.07      0.16      0.21</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 1]                       0.01    0.00 0.01      0.00      0.00      0.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 2]                       0.15    0.00 0.04      0.09      0.12      0.15</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 3]                       0.27    0.00 0.09      0.10      0.20      0.26</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 4]                       0.27    0.00 0.11      0.04      0.19      0.27</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 5]                       0.12    0.00 0.09      0.00      0.05      0.10</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 6]                       0.19    0.00 0.08      0.05      0.14      0.19</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 1]                       0.02    0.00 0.00      0.01      0.02      0.02</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 2]                       0.11    0.00 0.01      0.08      0.10      0.11</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 3]                       0.29    0.00 0.04      0.21      0.26      0.28</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 4]                       0.23    0.00 0.06      0.12      0.20      0.24</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 5]                       0.18    0.00 0.06      0.07      0.14      0.18</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 6]                       0.16    0.00 0.03      0.10      0.14      0.16</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 1]                        0.01    0.00 0.01      0.00      0.01      0.01</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 2]                        0.13    0.00 0.02      0.09      0.12      0.13</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 3]                        0.37    0.00 0.05      0.26      0.33      0.37</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 4]                        0.15    0.00 0.08      0.01      0.09      0.14</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 5]                        0.28    0.00 0.08      0.12      0.23      0.29</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 6]                        0.06    0.00 0.04      0.00      0.03      0.06</span></span>
<span><span class="co">#&gt;                                              75%     97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; beta[age]                                   0.08      0.09  4785    1</span></span>
<span><span class="co">#&gt; beta[iss_stage3]                            0.44      0.61  9636    1</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr]                     -0.07      0.06  7143    1</span></span>
<span><span class="co">#&gt; beta[male]                                  0.08      0.21 11638    1</span></span>
<span><span class="co">#&gt; beta[age:.trtclassActive]                  -0.01      0.00  5969    1</span></span>
<span><span class="co">#&gt; beta[iss_stage3:.trtclassActive]            0.33      0.55  9439    1</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr:.trtclassActive]      0.29      0.48  6518    1</span></span>
<span><span class="co">#&gt; beta[male:.trtclassActive]                  0.23      0.42  9271    1</span></span>
<span><span class="co">#&gt; d[Len]                                     -0.63     -0.56  6105    1</span></span>
<span><span class="co">#&gt; d[Thal]                                    -0.13      0.01  6436    1</span></span>
<span><span class="co">#&gt; lp__                                   -12434.68 -12429.63  1236    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 1]                         0.02      0.04  3682    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 2]                         0.13      0.17  2921    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 3]                         0.25      0.34  2594    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 4]                         0.44      0.53  2511    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 5]                         0.14      0.24  3383    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 6]                         0.21      0.27  4507    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 1]                      0.00      0.01  6677    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 2]                      0.14      0.18  3644    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 3]                      0.24      0.33  2551    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 4]                      0.36      0.47  2414    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 5]                      0.23      0.39  3211    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 6]                      0.26      0.35  4569    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 1]                       0.01      0.02  6325    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 2]                       0.17      0.22  5110    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 3]                       0.33      0.44  3219    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 4]                       0.34      0.48  2887    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 5]                       0.17      0.32  4497    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 6]                       0.25      0.35  5667    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 1]                       0.02      0.03  6003    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 2]                       0.12      0.14  3181    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 3]                       0.31      0.36  3327    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 4]                       0.27      0.35  2815    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 5]                       0.22      0.30  3409    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 6]                       0.19      0.23  4284    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 1]                        0.01      0.02  4714    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 2]                        0.14      0.17  4716    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 3]                        0.40      0.46  3378    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 4]                        0.20      0.32  3326    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 5]                        0.34      0.42  3824    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 6]                        0.09      0.16  4608    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Fri Aug 25 19:38:00 2023.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span>
<span></span>
<span><span class="va">ndmm_fit_3kt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">ndmm_net</span>,</span>
<span>                    regression <span class="op">=</span> <span class="op">~</span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="va">iss_stage3</span> <span class="op">+</span> <span class="va">response_cr_vgpr</span> <span class="op">+</span> <span class="va">male</span><span class="op">)</span><span class="op">*</span><span class="va">.trt</span>,</span>
<span>                    likelihood <span class="op">=</span> <span class="st">"mspline"</span>,</span>
<span>                    n_knots <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                    prior_intercept <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_reg <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_aux <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">dirichlet</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                    QR <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    <span class="co"># Reducing max_treedepth can speed up warm-up, but</span></span>
<span>                    <span class="co"># increase if max_treedepth errors occur</span></span>
<span>                    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_treedepth <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: Setting "Pbo" as the network reference treatment.</span></span>
<span></span>
<span><span class="va">ndmm_fit_3kt</span></span>
<span><span class="co">#&gt; A fixed effects ML-NMR with a mspline likelihood (log link).</span></span>
<span><span class="co">#&gt; Regression model: ~(age + iss_stage3 + response_cr_vgpr + male) * .trt.</span></span>
<span><span class="co">#&gt; Centred covariates at the following overall mean values:</span></span>
<span><span class="co">#&gt;              age       iss_stage3 response_cr_vgpr             male </span></span>
<span><span class="co">#&gt;       61.6558571        0.2297184        0.7314265        0.6020451 </span></span>
<span><span class="co">#&gt; Inference for Stan model: survival_mspline.</span></span>
<span><span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                             mean se_mean   sd      2.5%       25%       50%</span></span>
<span><span class="co">#&gt; beta[age]                                   0.08    0.00 0.01      0.06      0.07      0.08</span></span>
<span><span class="co">#&gt; beta[iss_stage3]                            0.35    0.00 0.13      0.08      0.26      0.35</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr]                     -0.14    0.00 0.10     -0.33     -0.20     -0.14</span></span>
<span><span class="co">#&gt; beta[male]                                  0.01    0.00 0.10     -0.19     -0.06      0.01</span></span>
<span><span class="co">#&gt; beta[age:.trtclassActive]                  -0.02    0.00 0.01     -0.03     -0.02     -0.02</span></span>
<span><span class="co">#&gt; beta[iss_stage3:.trtclassActive]            0.20    0.00 0.17     -0.13      0.08      0.20</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr:.trtclassActive]      0.20    0.00 0.14     -0.07      0.11      0.20</span></span>
<span><span class="co">#&gt; beta[male:.trtclassActive]                  0.13    0.00 0.15     -0.16      0.02      0.13</span></span>
<span><span class="co">#&gt; d[Len]                                     -0.67    0.00 0.05     -0.77     -0.70     -0.67</span></span>
<span><span class="co">#&gt; d[Thal]                                    -0.19    0.00 0.11     -0.40     -0.27     -0.19</span></span>
<span><span class="co">#&gt; lp__                                   -12455.31    0.14 5.25 -12466.37 -12458.71 -12454.92</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 1]                         0.01    0.00 0.01      0.00      0.01      0.01</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 2]                         0.07    0.00 0.03      0.02      0.05      0.07</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 3]                         0.13    0.00 0.04      0.04      0.10      0.13</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 4]                         0.29    0.00 0.06      0.17      0.25      0.29</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 5]                         0.25    0.00 0.07      0.11      0.20      0.25</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 6]                         0.09    0.00 0.06      0.01      0.04      0.08</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 7]                         0.16    0.00 0.04      0.09      0.13      0.16</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 1]                      0.00    0.00 0.00      0.00      0.00      0.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 2]                      0.05    0.00 0.02      0.01      0.04      0.05</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 3]                      0.18    0.00 0.04      0.10      0.15      0.18</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 4]                      0.15    0.00 0.06      0.03      0.10      0.15</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 5]                      0.32    0.00 0.08      0.16      0.26      0.32</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 6]                      0.10    0.00 0.07      0.00      0.04      0.08</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 7]                      0.21    0.00 0.07      0.08      0.16      0.21</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 1]                       0.00    0.00 0.00      0.00      0.00      0.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 2]                       0.08    0.00 0.03      0.03      0.07      0.08</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 3]                       0.13    0.00 0.05      0.03      0.09      0.13</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 4]                       0.29    0.00 0.09      0.10      0.23      0.29</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 5]                       0.19    0.00 0.10      0.02      0.12      0.19</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 6]                       0.11    0.00 0.08      0.00      0.05      0.10</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 7]                       0.18    0.00 0.08      0.04      0.12      0.18</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 1]                       0.01    0.00 0.00      0.01      0.01      0.01</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 2]                       0.07    0.00 0.01      0.05      0.06      0.07</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 3]                       0.13    0.00 0.02      0.09      0.11      0.13</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 4]                       0.29    0.00 0.04      0.22      0.26      0.29</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 5]                       0.18    0.00 0.05      0.07      0.14      0.18</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 6]                       0.18    0.00 0.05      0.08      0.15      0.18</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 7]                       0.13    0.00 0.03      0.08      0.11      0.13</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 1]                        0.01    0.00 0.00      0.00      0.00      0.01</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 2]                        0.07    0.00 0.01      0.04      0.06      0.07</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 3]                        0.16    0.00 0.03      0.11      0.14      0.16</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 4]                        0.32    0.00 0.05      0.21      0.28      0.32</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 5]                        0.15    0.00 0.08      0.02      0.10      0.15</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 6]                        0.24    0.00 0.07      0.10      0.20      0.25</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 7]                        0.05    0.00 0.04      0.00      0.02      0.05</span></span>
<span><span class="co">#&gt;                                              75%     97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; beta[age]                                   0.08      0.09  4506    1</span></span>
<span><span class="co">#&gt; beta[iss_stage3]                            0.44      0.61  6426    1</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr]                     -0.07      0.07  7209    1</span></span>
<span><span class="co">#&gt; beta[male]                                  0.07      0.21  8857    1</span></span>
<span><span class="co">#&gt; beta[age:.trtclassActive]                  -0.01      0.00  5260    1</span></span>
<span><span class="co">#&gt; beta[iss_stage3:.trtclassActive]            0.32      0.55  6366    1</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr:.trtclassActive]      0.30      0.48  6422    1</span></span>
<span><span class="co">#&gt; beta[male:.trtclassActive]                  0.23      0.42  8144    1</span></span>
<span><span class="co">#&gt; d[Len]                                     -0.63     -0.56  5030    1</span></span>
<span><span class="co">#&gt; d[Thal]                                    -0.12      0.02  5503    1</span></span>
<span><span class="co">#&gt; lp__                                   -12451.50 -12446.12  1382    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 1]                         0.02      0.03  3352    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 2]                         0.09      0.12  2388    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 3]                         0.15      0.21  2194    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 4]                         0.34      0.42  2340    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 5]                         0.30      0.37  2473    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 6]                         0.13      0.22  3104    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 7]                         0.19      0.24  4230    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 1]                      0.00      0.01  6289    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 2]                      0.06      0.09  2993    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 3]                      0.21      0.26  2593    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 4]                      0.19      0.28  2638    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 5]                      0.37      0.46  2649    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 6]                      0.14      0.27  3040    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 7]                      0.25      0.33  5255    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 1]                       0.01      0.02  6677    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 2]                       0.10      0.14  4492    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 3]                       0.17      0.25  3415    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 4]                       0.36      0.47  2937    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 5]                       0.26      0.40  2979    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 6]                       0.17      0.30  4765    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 7]                       0.23      0.34  5738    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 1]                       0.02      0.02  4062    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 2]                       0.08      0.09  3391    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 3]                       0.14      0.17  2978    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 4]                       0.31      0.36  3043    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 5]                       0.22      0.28  2885    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 6]                       0.22      0.29  3491    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 7]                       0.15      0.20  4055    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 1]                        0.01      0.02  4940    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 2]                        0.08      0.10  3823    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 3]                        0.18      0.22  3920    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 4]                        0.35      0.42  3178    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 5]                        0.20      0.31  2888    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 6]                        0.29      0.37  3457    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 7]                        0.07      0.13  5032    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Fri Aug 25 20:28:03 2023.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span></code></pre></div>
<p>We then compare the LOOIC, using the <code>loo</code> package.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">ndmm_fit_1kt_loo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.html">loo</a></span><span class="op">(</span><span class="va">ndmm_fit_1kt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 4000 by 4144 log-likelihood matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate    SE</span></span>
<span><span class="co">#&gt; elpd_loo -12385.5 116.2</span></span>
<span><span class="co">#&gt; p_loo        31.8   0.8</span></span>
<span><span class="co">#&gt; looic     24770.9 232.5</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; Monte Carlo SE of elpd_loo is 0.1.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All Pareto k estimates are good (k &lt; 0.5).</span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span></span>
<span><span class="op">(</span><span class="va">ndmm_fit_2kt_loo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.html">loo</a></span><span class="op">(</span><span class="va">ndmm_fit_2kt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 4000 by 4144 log-likelihood matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate    SE</span></span>
<span><span class="co">#&gt; elpd_loo -12386.1 116.2</span></span>
<span><span class="co">#&gt; p_loo        35.9   0.9</span></span>
<span><span class="co">#&gt; looic     24772.2 232.4</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; Monte Carlo SE of elpd_loo is 0.1.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All Pareto k estimates are good (k &lt; 0.5).</span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span></span>
<span><span class="op">(</span><span class="va">ndmm_fit_3kt_loo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.html">loo</a></span><span class="op">(</span><span class="va">ndmm_fit_3kt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 4000 by 4144 log-likelihood matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate    SE</span></span>
<span><span class="co">#&gt; elpd_loo -12388.2 116.2</span></span>
<span><span class="co">#&gt; p_loo        40.1   0.9</span></span>
<span><span class="co">#&gt; looic     24776.3 232.5</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; Monte Carlo SE of elpd_loo is 0.1.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All Pareto k estimates are good (k &lt; 0.5).</span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html" class="external-link">loo_compare</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1 knot"</span> <span class="op">=</span> <span class="va">ndmm_fit_1kt_loo</span>,</span>
<span>                 <span class="st">"2 knots"</span> <span class="op">=</span> <span class="va">ndmm_fit_2kt_loo</span>,</span>
<span>                 <span class="st">"3 knots"</span> <span class="op">=</span> <span class="va">ndmm_fit_3kt_loo</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         elpd_diff se_diff</span></span>
<span><span class="co">#&gt; 1 knot   0.0       0.0   </span></span>
<span><span class="co">#&gt; 2 knots -0.7       2.1   </span></span>
<span><span class="co">#&gt; 3 knots -2.7       2.7   </span></span></code></pre></div>
<p>The model with a single internal knot at the median uncensored
survival time has the lowest LOOIC (highest ELPD). Increasing the number
of knots does not improve overall model fit in this case.</p>
<p>It is also important to check the model fit within each study, to
check that no single study has a better fit with a larger number of
knots which could be washed out by the increased model complexity in
other studies.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">studies_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ndmm_ipd</span><span class="op">$</span><span class="va">study</span>, <span class="va">ndmm_agd</span><span class="op">$</span><span class="va">study</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  `1 knot` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">ndmm_fit_1kt_loo</span><span class="op">$</span><span class="va">pointwise</span><span class="op">[</span>, <span class="st">"looic"</span><span class="op">]</span>, <span class="va">studies_all</span>, <span class="va">sum</span><span class="op">)</span>,</span>
<span>  `2 knots` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">ndmm_fit_2kt_loo</span><span class="op">$</span><span class="va">pointwise</span><span class="op">[</span>, <span class="st">"looic"</span><span class="op">]</span>, <span class="va">studies_all</span>, <span class="va">sum</span><span class="op">)</span>,</span>
<span>  `3 knots` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">ndmm_fit_3kt_loo</span><span class="op">$</span><span class="va">pointwise</span><span class="op">[</span>, <span class="st">"looic"</span><span class="op">]</span>, <span class="va">studies_all</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;                 1 knot   2 knots   3 knots</span></span>
<span><span class="co">#&gt; Attal2012     3342.043  3341.188  3342.966</span></span>
<span><span class="co">#&gt; Jackson2019  12394.107 12395.073 12396.222</span></span>
<span><span class="co">#&gt; McCarthy2012  2723.239  2724.039  2723.232</span></span>
<span><span class="co">#&gt; Morgan2012    4981.445  4981.976  4983.157</span></span>
<span><span class="co">#&gt; Palumbo2014   1330.072  1329.954  1330.747</span></span></code></pre></div>
<p>We conclude that 1 knot is sufficient for all studies.</p>
</div>
<div class="section level3">
<h3 id="ploting-hazards">Ploting hazards<a class="anchor" aria-label="anchor" href="#ploting-hazards"></a>
</h3>
<p>Let us look at the estimated hazard functions under each model with
increasing numbers of knots.</p>
<p>By default, the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function with
<code>type = "hazard"</code> will produce plots of the
population-average marginal hazards (<code>level = "aggregate"</code>,
which is the default). These can then be plotted using the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function. We combine the plots into one grid using
the <code>patchwork</code> package.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mhp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ndmm_fit_1kt</span>, type <span class="op">=</span> <span class="st">"hazard"</span>, level <span class="op">=</span> <span class="st">"aggregate"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mhp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ndmm_fit_2kt</span>, type <span class="op">=</span> <span class="st">"hazard"</span>, level <span class="op">=</span> <span class="st">"aggregate"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mhp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ndmm_fit_3kt</span>, type <span class="op">=</span> <span class="st">"hazard"</span>, level <span class="op">=</span> <span class="st">"aggregate"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combining these into a single plot using patchwork</span></span>
<span><span class="va">mhp1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="st">"1 knot"</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Study</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">mhp2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="st">"2 knots"</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Study</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">mhp3</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="st">"3 knots"</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Study</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span>, guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/ndmm-marginal-hazards-1.png" style="display: block; margin: auto;"></p>
<p>We see that with increasing numbers of knots the marginal hazards
become increasingly “wiggly”, which in this case is overfitting.</p>
<p>We can also look at the individual-level baseline hazards. This is
again possible using the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function, this time with
<code>level = "individual"</code>. Since we want to show the baseline
hazard for the reference level of the covariates, we’ll create a data
frame to pass to <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> as <code>newdata</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">refdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>study <span class="op">=</span> <span class="va">ndmm_net</span><span class="op">$</span><span class="va">studies</span>,</span>
<span>                 age <span class="op">=</span> <span class="va">ndmm_fit_1kt</span><span class="op">$</span><span class="va">xbar</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span>,</span>
<span>                 iss_stage3 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                 response_cr_vgpr <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                 male <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Since we are providing a new data frame for prediction, we also need
to provide the times to predict at and the distributions of the baseline
(intercept) and auxiliary (spline coefficient) parameters. We will
predict at evenly spaced times between time 0 and the last
event/censoring time in each study. We specify a named list of the study
names for both <code>baseline</code> and <code>aux</code>, to use the
posterior distributions from each study for these parameters.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># At evenly spaced times between the boundary knots</span></span>
<span><span class="va">tdat</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">imap_dfr</a></span><span class="op">(</span><span class="va">ndmm_fit_1kt</span><span class="op">$</span><span class="va">basis</span>,</span>
<span>                        <span class="op">~</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>study <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">.y</span>, levels <span class="op">=</span> <span class="va">ndmm_net</span><span class="op">$</span><span class="va">studies</span><span class="op">)</span>,</span>
<span>                                lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"Boundary.knots"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                                upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"Boundary.knots"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                                times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">lower</span>, <span class="va">upper</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">refdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">refdat</span>, <span class="va">tdat</span>, by <span class="op">=</span> <span class="st">"study"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">studies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span>nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">ndmm_net</span><span class="op">$</span><span class="va">studies</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we produce the predictions, plot and combine using
<code>patchwork</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bhp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ndmm_fit_1kt</span>, type <span class="op">=</span> <span class="st">"hazard"</span>, level <span class="op">=</span> <span class="st">"individual"</span>,</span>
<span>                    newdata <span class="op">=</span> <span class="va">refdat</span>, study <span class="op">=</span> <span class="va">study</span>, times <span class="op">=</span> <span class="va">times</span>,</span>
<span>                    baseline <span class="op">=</span> <span class="va">studies</span>, aux <span class="op">=</span> <span class="va">studies</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bhp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ndmm_fit_2kt</span>, type <span class="op">=</span> <span class="st">"hazard"</span>, level <span class="op">=</span> <span class="st">"individual"</span>,</span>
<span>                    newdata <span class="op">=</span> <span class="va">refdat</span>, study <span class="op">=</span> <span class="va">study</span>, times <span class="op">=</span> <span class="va">times</span>,</span>
<span>                    baseline <span class="op">=</span> <span class="va">studies</span>, aux <span class="op">=</span> <span class="va">studies</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bhp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ndmm_fit_3kt</span>, type <span class="op">=</span> <span class="st">"hazard"</span>, level <span class="op">=</span> <span class="st">"individual"</span>,</span>
<span>                    newdata <span class="op">=</span> <span class="va">refdat</span>, study <span class="op">=</span> <span class="va">study</span>, times <span class="op">=</span> <span class="va">times</span>,</span>
<span>                    baseline <span class="op">=</span> <span class="va">studies</span>, aux <span class="op">=</span> <span class="va">studies</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combining these into a single plot using patchwork</span></span>
<span><span class="va">bhp1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="st">"1 knot"</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Study</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">bhp2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="st">"2 knots"</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Study</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">bhp3</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="st">"3 knots"</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Study</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span>, guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/ndmm-baseline-hazards-1.png" style="display: block; margin: auto;"></p>
<p>Again, we see that as the number of knots increases the baseline
hazards get more “wiggly”. As noted above, based on LOOIC the model with
1 internal knot is sufficient here.</p>
</div>
</div>
<div class="section level2">
<h2 id="assessing-the-proportional-hazards-assumption">Assessing the proportional hazards assumption<a class="anchor" aria-label="anchor" href="#assessing-the-proportional-hazards-assumption"></a>
</h2>
<p>We can relax and assess the proportional hazards (PH) assumption by
allowing the spline coefficients to vary between treatment arms within
each study. This is achieved using the <code>aux_by</code> argument,
with <code>aux_by = c(.study, .trt)</code>. Technically,
<code>aux_by = .study</code> is always assumed in order to respect
randomisation (analogous to stratifying the intercept terms in a NMA by
study), and we could simply write <code>aux_by = .trt</code>; but we
choose to make the stratification by study explicit in this
instance.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndmm_fit_nph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">ndmm_net</span>,</span>
<span>                    regression <span class="op">=</span> <span class="op">~</span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="va">iss_stage3</span> <span class="op">+</span> <span class="va">response_cr_vgpr</span> <span class="op">+</span> <span class="va">male</span><span class="op">)</span><span class="op">*</span><span class="va">.trt</span>,</span>
<span>                    likelihood <span class="op">=</span> <span class="st">"mspline"</span>,</span>
<span>                    n_knots <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    prior_intercept <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_reg <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_aux <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">dirichlet</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                    aux_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.study</span>, <span class="va">.trt</span><span class="op">)</span>,</span>
<span>                    QR <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    <span class="co"># Reducing max_treedepth can speed up warm-up, but</span></span>
<span>                    <span class="co"># increase if max_treedepth errors occur</span></span>
<span>                    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_treedepth <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: Setting "Pbo" as the network reference treatment.</span></span>
<span></span>
<span><span class="va">ndmm_fit_nph</span></span>
<span><span class="co">#&gt; A fixed effects ML-NMR with a mspline likelihood (log link).</span></span>
<span><span class="co">#&gt; Regression model: ~(age + iss_stage3 + response_cr_vgpr + male) * .trt.</span></span>
<span><span class="co">#&gt; Centred covariates at the following overall mean values:</span></span>
<span><span class="co">#&gt;              age       iss_stage3 response_cr_vgpr             male </span></span>
<span><span class="co">#&gt;       61.6558571        0.2297184        0.7314265        0.6020451 </span></span>
<span><span class="co">#&gt; Inference for Stan model: survival_mspline.</span></span>
<span><span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                             mean se_mean   sd      2.5%       25%       50%</span></span>
<span><span class="co">#&gt; beta[age]                                   0.07    0.00 0.01      0.06      0.07      0.07</span></span>
<span><span class="co">#&gt; beta[iss_stage3]                            0.33    0.00 0.13      0.07      0.24      0.34</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr]                     -0.11    0.00 0.10     -0.29     -0.17     -0.11</span></span>
<span><span class="co">#&gt; beta[male]                                  0.00    0.00 0.10     -0.21     -0.07      0.00</span></span>
<span><span class="co">#&gt; beta[age:.trtclassActive]                  -0.01    0.00 0.01     -0.03     -0.02     -0.01</span></span>
<span><span class="co">#&gt; beta[iss_stage3:.trtclassActive]            0.24    0.00 0.18     -0.11      0.11      0.24</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr:.trtclassActive]      0.15    0.00 0.14     -0.12      0.06      0.15</span></span>
<span><span class="co">#&gt; beta[male:.trtclassActive]                  0.15    0.00 0.15     -0.14      0.05      0.15</span></span>
<span><span class="co">#&gt; d[Len]                                     -0.61    0.00 0.07     -0.75     -0.66     -0.61</span></span>
<span><span class="co">#&gt; d[Thal]                                    -0.27    0.00 0.13     -0.53     -0.35     -0.27</span></span>
<span><span class="co">#&gt; lp__                                   -12473.08    0.16 5.68 -12485.07 -12476.69 -12472.77</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 1]                    0.03    0.00 0.02      0.01      0.02      0.03</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 2]                    0.17    0.00 0.07      0.05      0.13      0.17</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 3]                    0.46    0.00 0.11      0.21      0.39      0.47</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 4]                    0.15    0.00 0.10      0.01      0.06      0.13</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 5]                    0.19    0.00 0.06      0.08      0.15      0.19</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 1]                    0.03    0.00 0.02      0.00      0.01      0.03</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 2]                    0.18    0.00 0.07      0.04      0.13      0.18</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 3]                    0.26    0.00 0.13      0.03      0.16      0.25</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 4]                    0.31    0.00 0.12      0.07      0.22      0.31</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 5]                    0.23    0.00 0.06      0.11      0.18      0.22</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 1]                 0.01    0.00 0.01      0.00      0.00      0.01</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 2]                 0.30    0.00 0.06      0.18      0.26      0.30</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 3]                 0.20    0.00 0.12      0.02      0.11      0.19</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 4]                 0.30    0.00 0.14      0.04      0.20      0.31</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 5]                 0.19    0.00 0.11      0.01      0.10      0.18</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 1]                 0.01    0.00 0.01      0.00      0.00      0.01</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 2]                 0.26    0.00 0.06      0.13      0.22      0.26</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 3]                 0.20    0.00 0.12      0.01      0.11      0.19</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 4]                 0.30    0.00 0.13      0.04      0.20      0.30</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 5]                 0.23    0.00 0.08      0.08      0.18      0.23</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 1]                  0.02    0.00 0.02      0.00      0.01      0.02</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 2]                  0.47    0.00 0.09      0.29      0.41      0.47</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 3]                  0.13    0.00 0.09      0.01      0.05      0.11</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 4]                  0.15    0.00 0.10      0.01      0.07      0.13</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 5]                  0.23    0.00 0.10      0.06      0.17      0.23</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 1]                  0.02    0.00 0.01      0.00      0.00      0.01</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 2]                  0.23    0.00 0.09      0.07      0.16      0.22</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 3]                  0.38    0.00 0.16      0.07      0.27      0.38</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 4]                  0.20    0.00 0.14      0.01      0.08      0.17</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 5]                  0.18    0.00 0.10      0.02      0.11      0.18</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 1]                  0.06    0.00 0.01      0.04      0.05      0.06</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 2]                  0.30    0.00 0.05      0.21      0.27      0.30</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 3]                  0.26    0.00 0.08      0.10      0.21      0.27</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 4]                  0.13    0.00 0.09      0.01      0.06      0.12</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 5]                  0.25    0.00 0.06      0.13      0.22      0.26</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 1]                  0.02    0.00 0.01      0.01      0.02      0.02</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 2]                  0.36    0.00 0.04      0.27      0.33      0.36</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 3]                  0.17    0.00 0.08      0.03      0.12      0.17</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 4]                  0.28    0.00 0.08      0.13      0.23      0.28</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 5]                  0.16    0.00 0.04      0.09      0.14      0.16</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 1]                   0.03    0.00 0.01      0.01      0.02      0.03</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 2]                   0.40    0.00 0.06      0.29      0.36      0.40</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 3]                   0.12    0.00 0.08      0.01      0.05      0.10</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 4]                   0.30    0.00 0.11      0.08      0.23      0.31</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 5]                   0.15    0.00 0.08      0.02      0.09      0.14</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 1]                  0.02    0.00 0.01      0.00      0.01      0.02</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 2]                  0.48    0.00 0.06      0.36      0.44      0.48</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 3]                  0.15    0.00 0.10      0.01      0.08      0.14</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 4]                  0.28    0.00 0.10      0.06      0.22      0.29</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 5]                  0.07    0.00 0.05      0.00      0.03      0.06</span></span>
<span><span class="co">#&gt;                                              75%     97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; beta[age]                                   0.08      0.09  2216 1.00</span></span>
<span><span class="co">#&gt; beta[iss_stage3]                            0.42      0.58  6138 1.00</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr]                     -0.04      0.08  5661 1.00</span></span>
<span><span class="co">#&gt; beta[male]                                  0.06      0.19  6871 1.00</span></span>
<span><span class="co">#&gt; beta[age:.trtclassActive]                  -0.01      0.01  2534 1.00</span></span>
<span><span class="co">#&gt; beta[iss_stage3:.trtclassActive]            0.36      0.59  5870 1.00</span></span>
<span><span class="co">#&gt; beta[response_cr_vgpr:.trtclassActive]      0.25      0.43  5511 1.00</span></span>
<span><span class="co">#&gt; beta[male:.trtclassActive]                  0.25      0.45  5021 1.00</span></span>
<span><span class="co">#&gt; d[Len]                                     -0.57     -0.48  3125 1.00</span></span>
<span><span class="co">#&gt; d[Thal]                                    -0.18     -0.02  3754 1.00</span></span>
<span><span class="co">#&gt; lp__                                   -12469.06 -12462.95  1240 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 1]                    0.04      0.07  3057 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 2]                    0.22      0.31  2162 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 3]                    0.54      0.65  2063 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 4]                    0.21      0.37  2671 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 5]                    0.23      0.31  4213 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 1]                    0.04      0.08  3132 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 2]                    0.23      0.32  2367 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 3]                    0.35      0.52  2260 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 4]                    0.40      0.54  2831 1.00</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 5]                    0.27      0.36  3702 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 1]                 0.01      0.03  5235 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 2]                 0.34      0.42  3670 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 3]                 0.28      0.45  3512 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 4]                 0.41      0.56  3277 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 5]                 0.27      0.41  3494 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 1]                 0.02      0.04  4684 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 2]                 0.30      0.38  3049 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 3]                 0.28      0.45  2374 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 4]                 0.40      0.55  3123 1.00</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 5]                 0.29      0.39  4068 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 1]                  0.03      0.07  4681 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 2]                  0.53      0.64  3988 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 3]                  0.18      0.34  4258 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 4]                  0.21      0.38  5324 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 5]                  0.30      0.42  5781 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 1]                  0.02      0.05  5708 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 2]                  0.29      0.41  3657 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 3]                  0.49      0.67  3305 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 4]                  0.29      0.52  3535 1.00</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 5]                  0.25      0.39  5333 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 1]                  0.06      0.08  2324 1.01</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 2]                  0.33      0.40  2500 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 3]                  0.32      0.41  2483 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 4]                  0.18      0.33  2635 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 5]                  0.29      0.37  3039 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 1]                  0.03      0.04  3353 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 2]                  0.39      0.44  1886 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 3]                  0.23      0.33  1757 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 4]                  0.34      0.43  2340 1.00</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 5]                  0.19      0.24  3382 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 1]                   0.04      0.06  3363 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 2]                   0.44      0.52  2588 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 3]                   0.17      0.31  2850 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 4]                   0.37      0.49  3817 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 5]                   0.20      0.31  3731 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 1]                  0.02      0.04  4551 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 2]                  0.52      0.60  3293 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 3]                  0.22      0.36  2756 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 4]                  0.35      0.45  3444 1.00</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 5]                  0.10      0.19  3985 1.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Fri Aug 25 21:49:33 2023.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span></code></pre></div>
<p>We then compare model fit between models with and without PH using
the LOOIC.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">ndmm_fit_nph_loo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.html">loo</a></span><span class="op">(</span><span class="va">ndmm_fit_nph</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 4000 by 4144 log-likelihood matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate    SE</span></span>
<span><span class="co">#&gt; elpd_loo -12389.4 116.2</span></span>
<span><span class="co">#&gt; p_loo        44.5   1.1</span></span>
<span><span class="co">#&gt; looic     24778.8 232.5</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; Monte Carlo SE of elpd_loo is 0.1.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All Pareto k estimates are good (k &lt; 0.5).</span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span></span>
<span><span class="co"># Compare to PH model</span></span>
<span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html" class="external-link">loo_compare</a></span><span class="op">(</span><span class="va">ndmm_fit_1kt_loo</span>, <span class="va">ndmm_fit_nph_loo</span><span class="op">)</span></span>
<span><span class="co">#&gt;        elpd_diff se_diff</span></span>
<span><span class="co">#&gt; model1  0.0       0.0   </span></span>
<span><span class="co">#&gt; model2 -3.9       4.4   </span></span></code></pre></div>
<p>The overall fit for the proportional hazards model is better (but not
substantially).</p>
<p>Again, we should check that no single study has a better fit with the
non-PH model.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  PH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">ndmm_fit_1kt_loo</span><span class="op">$</span><span class="va">pointwise</span><span class="op">[</span>, <span class="st">"looic"</span><span class="op">]</span>, <span class="va">studies_all</span>, <span class="va">sum</span><span class="op">)</span>,</span>
<span>  `non-PH` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">ndmm_fit_nph_loo</span><span class="op">$</span><span class="va">pointwise</span><span class="op">[</span>, <span class="st">"looic"</span><span class="op">]</span>, <span class="va">studies_all</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;                     PH    non-PH</span></span>
<span><span class="co">#&gt; Attal2012     3342.043  3344.800</span></span>
<span><span class="co">#&gt; Jackson2019  12394.107 12391.884</span></span>
<span><span class="co">#&gt; McCarthy2012  2723.239  2728.845</span></span>
<span><span class="co">#&gt; Morgan2012    4981.445  4984.381</span></span>
<span><span class="co">#&gt; Palumbo2014   1330.072  1328.877</span></span></code></pre></div>
<p>The LOOIC is slightly lower for the non-PH model in the Jackson2019
and Palumbo2014 studies, but not substantially so. For the other studies
the LOOIC is lower for the PH model. Overall, there is little evidence
to suggest that the proportional hazards assumption is invalid here.</p>
<div class="section level3">
<h3 id="comparison-to-unadjusted-nma">Comparison to unadjusted NMA<a class="anchor" aria-label="anchor" href="#comparison-to-unadjusted-nma"></a>
</h3>
<p>For comparison, we also fit NMA models without any covariate
adjustment, both with and without the proportional hazards
assumption.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndmm_fit_nma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">ndmm_net</span>,</span>
<span>                    likelihood <span class="op">=</span> <span class="st">"mspline"</span>,</span>
<span>                    n_knots <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    prior_intercept <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                    prior_aux <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">dirichlet</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: Setting "Pbo" as the network reference treatment.</span></span>
<span></span>
<span><span class="va">ndmm_fit_nma</span></span>
<span><span class="co">#&gt; A fixed effects ML-NMR with a mspline likelihood (log link).</span></span>
<span><span class="co">#&gt; Inference for Stan model: survival_mspline.</span></span>
<span><span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                             mean se_mean   sd      2.5%       25%       50%       75%     97.5%</span></span>
<span><span class="co">#&gt; d[Len]                     -0.52    0.00 0.04     -0.61     -0.55     -0.52     -0.49     -0.43</span></span>
<span><span class="co">#&gt; d[Thal]                    -0.10    0.00 0.09     -0.27     -0.16     -0.10     -0.04      0.06</span></span>
<span><span class="co">#&gt; lp__                   -12503.23    0.11 4.05 -12511.77 -12505.82 -12502.95 -12500.28 -12496.36</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 1]         0.03    0.00 0.01      0.01      0.02      0.03      0.04      0.06</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 2]         0.20    0.00 0.06      0.09      0.16      0.20      0.24      0.32</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 3]         0.39    0.00 0.10      0.19      0.33      0.40      0.46      0.58</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 4]         0.18    0.00 0.09      0.03      0.11      0.17      0.23      0.36</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 5]         0.20    0.00 0.04      0.12      0.17      0.20      0.23      0.28</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 1]      0.01    0.00 0.01      0.00      0.00      0.00      0.01      0.02</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 2]      0.32    0.00 0.05      0.23      0.29      0.32      0.35      0.41</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 3]      0.16    0.00 0.09      0.02      0.09      0.16      0.23      0.35</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 4]      0.30    0.00 0.11      0.09      0.22      0.30      0.37      0.50</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 5]      0.21    0.00 0.07      0.08      0.16      0.21      0.26      0.35</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 1]       0.02    0.00 0.02      0.00      0.01      0.01      0.03      0.06</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 2]       0.46    0.00 0.07      0.31      0.41      0.46      0.51      0.60</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 3]       0.18    0.00 0.10      0.01      0.10      0.17      0.25      0.39</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 4]       0.17    0.00 0.10      0.01      0.08      0.16      0.24      0.39</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 5]       0.18    0.00 0.07      0.04      0.13      0.18      0.23      0.33</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 1]       0.06    0.00 0.01      0.04      0.05      0.06      0.06      0.07</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 2]       0.39    0.00 0.03      0.33      0.37      0.39      0.42      0.46</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 3]       0.19    0.00 0.06      0.06      0.15      0.19      0.23      0.31</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 4]       0.20    0.00 0.06      0.08      0.16      0.20      0.24      0.32</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 5]       0.16    0.00 0.03      0.10      0.14      0.16      0.18      0.22</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 1]        0.03    0.00 0.01      0.01      0.03      0.03      0.04      0.06</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 2]        0.54    0.00 0.04      0.46      0.51      0.54      0.57      0.62</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 3]        0.07    0.00 0.06      0.00      0.03      0.06      0.11      0.21</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 4]        0.29    0.00 0.06      0.15      0.25      0.29      0.33      0.40</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 5]        0.06    0.00 0.04      0.01      0.03      0.06      0.09      0.15</span></span>
<span><span class="co">#&gt;                        n_eff Rhat</span></span>
<span><span class="co">#&gt; d[Len]                  2978    1</span></span>
<span><span class="co">#&gt; d[Thal]                 4013    1</span></span>
<span><span class="co">#&gt; lp__                    1395    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 1]     3007    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 2]     2364    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 3]     2346    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 4]     2882    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012, 5]     3828    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 1]  6595    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 2]  3449    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 3]  3024    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 4]  3374    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012, 5]  3625    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 1]   5315    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 2]   4138    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 3]   3389    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 4]   4881    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014, 5]   5368    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 1]   4388    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 2]   2848    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 3]   2470    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 4]   2915    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019, 5]   3695    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 1]    5208    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 2]    3911    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 3]    3425    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 4]    4896    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012, 5]    5102    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Fri Aug 25 21:55:07 2023.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span>
<span></span>
<span><span class="va">ndmm_fit_nma_nph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">ndmm_net</span>,</span>
<span>                        likelihood <span class="op">=</span> <span class="st">"mspline"</span>,</span>
<span>                        n_knots <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        prior_intercept <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                        prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                        prior_aux <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">dirichlet</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                        aux_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.study</span>, <span class="va">.trt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: Setting "Pbo" as the network reference treatment.</span></span>
<span></span>
<span><span class="va">ndmm_fit_nma_nph</span></span>
<span><span class="co">#&gt; A fixed effects ML-NMR with a mspline likelihood (log link).</span></span>
<span><span class="co">#&gt; Inference for Stan model: survival_mspline.</span></span>
<span><span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                  mean se_mean   sd      2.5%       25%       50%       75%</span></span>
<span><span class="co">#&gt; d[Len]                          -0.46    0.00 0.05     -0.56     -0.50     -0.46     -0.43</span></span>
<span><span class="co">#&gt; d[Thal]                         -0.13    0.00 0.10     -0.33     -0.20     -0.13     -0.06</span></span>
<span><span class="co">#&gt; lp__                        -12548.70    0.15 5.42 -12560.09 -12552.11 -12548.29 -12544.91</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 1]         0.04    0.00 0.02      0.01      0.02      0.03      0.05</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 2]         0.21    0.00 0.07      0.07      0.16      0.21      0.26</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 3]         0.45    0.00 0.11      0.21      0.38      0.46      0.53</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 4]         0.13    0.00 0.09      0.01      0.06      0.11      0.18</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 5]         0.17    0.00 0.05      0.07      0.13      0.17      0.21</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 1]         0.03    0.00 0.02      0.00      0.02      0.03      0.05</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 2]         0.19    0.00 0.07      0.04      0.14      0.19      0.24</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 3]         0.28    0.00 0.13      0.05      0.19      0.28      0.37</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 4]         0.28    0.00 0.12      0.05      0.20      0.28      0.37</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 5]         0.21    0.00 0.06      0.10      0.17      0.21      0.25</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 1]      0.01    0.00 0.01      0.00      0.00      0.01      0.02</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 2]      0.33    0.00 0.07      0.20      0.29      0.33      0.38</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 3]      0.20    0.00 0.12      0.02      0.11      0.19      0.28</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 4]      0.28    0.00 0.14      0.03      0.18      0.28      0.38</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 5]      0.17    0.00 0.11      0.01      0.09      0.16      0.25</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 1]      0.01    0.00 0.01      0.00      0.00      0.01      0.02</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 2]      0.29    0.00 0.07      0.16      0.24      0.29      0.34</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 3]      0.19    0.00 0.12      0.01      0.10      0.18      0.28</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 4]      0.28    0.00 0.13      0.04      0.19      0.28      0.38</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 5]      0.22    0.00 0.08      0.08      0.17      0.22      0.27</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 1]       0.04    0.00 0.03      0.00      0.02      0.03      0.06</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 2]       0.54    0.00 0.09      0.34      0.48      0.54      0.60</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 3]       0.11    0.00 0.09      0.00      0.04      0.09      0.16</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 4]       0.13    0.00 0.09      0.01      0.06      0.12      0.19</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 5]       0.18    0.00 0.08      0.04      0.12      0.18      0.24</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 1]       0.02    0.00 0.02      0.00      0.01      0.01      0.03</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 2]       0.25    0.00 0.10      0.07      0.18      0.25      0.32</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 3]       0.37    0.00 0.16      0.06      0.26      0.37      0.48</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 4]       0.18    0.00 0.13      0.01      0.07      0.15      0.27</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 5]       0.18    0.00 0.10      0.02      0.11      0.18      0.25</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 1]       0.08    0.00 0.01      0.06      0.07      0.08      0.09</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 2]       0.38    0.00 0.05      0.29      0.35      0.38      0.42</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 3]       0.22    0.00 0.07      0.07      0.17      0.22      0.27</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 4]       0.11    0.00 0.07      0.01      0.05      0.10      0.16</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 5]       0.20    0.00 0.05      0.11      0.17      0.20      0.24</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 1]       0.03    0.00 0.01      0.01      0.02      0.03      0.03</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 2]       0.42    0.00 0.04      0.33      0.39      0.42      0.45</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 3]       0.16    0.00 0.08      0.02      0.10      0.15      0.21</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 4]       0.26    0.00 0.07      0.11      0.22      0.27      0.32</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 5]       0.14    0.00 0.03      0.07      0.11      0.13      0.16</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 1]        0.05    0.00 0.02      0.02      0.04      0.05      0.06</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 2]        0.48    0.00 0.06      0.36      0.44      0.48      0.52</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 3]        0.10    0.00 0.08      0.00      0.04      0.09      0.15</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 4]        0.25    0.00 0.09      0.05      0.19      0.25      0.31</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 5]        0.12    0.00 0.06      0.02      0.07      0.11      0.16</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 1]       0.02    0.00 0.01      0.00      0.01      0.02      0.03</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 2]       0.56    0.00 0.06      0.44      0.52      0.56      0.60</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 3]       0.12    0.00 0.08      0.01      0.06      0.11      0.17</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 4]       0.24    0.00 0.08      0.06      0.19      0.25      0.30</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 5]       0.06    0.00 0.04      0.00      0.03      0.05      0.09</span></span>
<span><span class="co">#&gt;                                 97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; d[Len]                          -0.36  3061    1</span></span>
<span><span class="co">#&gt; d[Thal]                          0.07  3427    1</span></span>
<span><span class="co">#&gt; lp__                        -12539.10  1292    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 1]         0.08  3716    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 2]         0.36  2527    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 3]         0.65  2431    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 4]         0.34  2795    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Pbo, 5]         0.28  3952    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 1]         0.09  3219    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 2]         0.33  2734    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 3]         0.54  2558    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 4]         0.51  2982    1</span></span>
<span><span class="co">#&gt; scoef[Attal2012: Len, 5]         0.33  4146    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 1]      0.04  5654    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 2]      0.47  3260    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 3]      0.45  3526    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 4]      0.53  3302    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Pbo, 5]      0.40  3313    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 1]      0.05  5359    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 2]      0.42  3494    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 3]      0.44  2615    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 4]      0.52  3389    1</span></span>
<span><span class="co">#&gt; scoef[McCarthy2012: Len, 5]      0.37  4228    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 1]       0.11  4909    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 2]       0.70  4223    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 3]       0.31  3717    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 4]       0.34  4973    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Pbo, 5]       0.34  6107    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 1]       0.06  5491    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 2]       0.45  4035    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 3]       0.66  3294    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 4]       0.48  3538    1</span></span>
<span><span class="co">#&gt; scoef[Palumbo2014: Len, 5]       0.38  5038    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 1]       0.11  4284    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 2]       0.48  2761    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 3]       0.36  2322    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 4]       0.27  2512    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Pbo, 5]       0.30  3455    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 1]       0.05  4152    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 2]       0.50  3220    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 3]       0.32  2662    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 4]       0.39  2987    1</span></span>
<span><span class="co">#&gt; scoef[Jackson2019: Len, 5]       0.21  4141    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 1]        0.09  4143    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 2]        0.59  3575    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 3]        0.28  3103    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 4]        0.41  4253    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Pbo, 5]        0.25  4940    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 1]       0.05  5500    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 2]       0.67  4790    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 3]       0.30  3678    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 4]       0.39  4719    1</span></span>
<span><span class="co">#&gt; scoef[Morgan2012: Thal, 5]       0.16  4992    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Fri Aug 25 22:00:38 2023.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span></code></pre></div>
<p>Again, we compare the model fit using the LOOIC, both overall and
within each study.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare overall model fit</span></span>
<span><span class="op">(</span><span class="va">ndmm_fit_nma_loo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.html">loo</a></span><span class="op">(</span><span class="va">ndmm_fit_nma</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 4000 by 4144 log-likelihood matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate    SE</span></span>
<span><span class="co">#&gt; elpd_loo -12461.3 115.4</span></span>
<span><span class="co">#&gt; p_loo        22.6   0.6</span></span>
<span><span class="co">#&gt; looic     24922.7 230.8</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; Monte Carlo SE of elpd_loo is 0.1.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All Pareto k estimates are good (k &lt; 0.5).</span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span></span>
<span><span class="op">(</span><span class="va">ndmm_fit_nma_nph_loo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.html">loo</a></span><span class="op">(</span><span class="va">ndmm_fit_nma_nph</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 4000 by 4144 log-likelihood matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate    SE</span></span>
<span><span class="co">#&gt; elpd_loo -12460.3 115.4</span></span>
<span><span class="co">#&gt; p_loo        35.1   1.0</span></span>
<span><span class="co">#&gt; looic     24920.5 230.9</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; Monte Carlo SE of elpd_loo is 0.1.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All Pareto k estimates are good (k &lt; 0.5).</span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html" class="external-link">loo_compare</a></span><span class="op">(</span><span class="va">ndmm_fit_nma_loo</span>, <span class="va">ndmm_fit_nma_nph_loo</span><span class="op">)</span></span>
<span><span class="co">#&gt;        elpd_diff se_diff</span></span>
<span><span class="co">#&gt; model2  0.0       0.0   </span></span>
<span><span class="co">#&gt; model1 -1.1       5.3   </span></span>
<span></span>
<span><span class="co"># Compare model fit by study</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  PH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">ndmm_fit_nma_loo</span><span class="op">$</span><span class="va">pointwise</span><span class="op">[</span>, <span class="st">"looic"</span><span class="op">]</span>, <span class="va">studies_all</span>, <span class="va">sum</span><span class="op">)</span>,</span>
<span>  `non-PH` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">ndmm_fit_nma_nph_loo</span><span class="op">$</span><span class="va">pointwise</span><span class="op">[</span>, <span class="st">"looic"</span><span class="op">]</span>, <span class="va">studies_all</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;                     PH    non-PH</span></span>
<span><span class="co">#&gt; Attal2012     3406.395  3408.744</span></span>
<span><span class="co">#&gt; Jackson2019  12401.491 12391.276</span></span>
<span><span class="co">#&gt; McCarthy2012  2766.946  2771.886</span></span>
<span><span class="co">#&gt; Morgan2012    4981.328  4984.390</span></span>
<span><span class="co">#&gt; Palumbo2014   1366.513  1364.247</span></span></code></pre></div>
<p>Whilst there is little difference in overall model fit, the non-PH
model is preferred in the Jackson2019 study with a substantially lower
LOOIC. Including the covariates in the ML-NMR model is sufficient to
remove this PH violation, even though the covariates are fixed and not
time-varying, and the ML-NMR model is a much better fit overall.</p>
</div>
</div>
<div class="section level2">
<h2 id="producing-population-average-estimates">Producing population-average estimates<a class="anchor" aria-label="anchor" href="#producing-population-average-estimates"></a>
</h2>
<p>We now produce population-average estimates for several different
quantities of interest. The usual array of posterior summary functions
is available, including <code><a href="../reference/relative_effects.html">relative_effects()</a></code>,
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>, <code><a href="../reference/posterior_ranks.html">posterior_ranks()</a></code> and
<code><a href="../reference/posterior_ranks.html">posterior_rank_probs()</a></code>. The <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function
in particular has numerous options when working with survival models,
selected using the <code>type</code> argument:</p>
<ul>
<li>
<code>"survival"</code> for survival probabilities</li>
<li>
<code>"hazard"</code> for hazards</li>
<li>
<code>"cumhaz"</code> for cumulative hazards</li>
<li>
<code>"rmst"</code> for restricted mean survival times</li>
<li>
<code>"mean"</code> for mean survival times (equivalent to
<code>type = "rmst"</code> with <code>time = Inf</code>)</li>
<li>
<code>"quantile"</code> for quantiles of the survival time
distribution</li>
<li>
<code>"median"</code> for median survival times (equivalent to
<code>type = "quantile"</code> with <code>quantiles = 0.5</code>)</li>
<li>
<code>"link"</code> for the linear predictor</li>
</ul>
<p>When producing population-average predictions (which is the default
with <code>level = "aggregate"</code>), each of these quantities
corresponds to the population-average marginal survival function; see
<code><a href="../reference/predict.stan_nma.html">?predict.stan_nma</a></code> for more details.</p>
<div class="section level3">
<h3 id="population-average-survival-probabilities">Population-average survival probabilities<a class="anchor" aria-label="anchor" href="#population-average-survival-probabilities"></a>
</h3>
<p>To produce population-average survival curves we use the
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function with <code>type = "survival"</code>.
These are marginal or standardised survival curves.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ndmm_fit_1kt</span>, type <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overlay the KM data</span></span>
<span><span class="va">kmdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ndmm_ipd</span>, <span class="va">ndmm_agd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">studyf</span>, <span class="va">trtf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_modify</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">eventtime</span>, event <span class="op">=</span> <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">n.censor</span>, estimate <span class="op">=</span> <span class="va">surv</span>, <span class="va">std.err</span>, <span class="va">upper</span>, <span class="va">lower</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add S(0) = 1</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_modify</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span><span class="va">.</span>, time <span class="op">=</span> <span class="fl">0</span>, n.censor <span class="op">=</span> <span class="fl">0</span>, estimate <span class="op">=</span> <span class="fl">1</span>, std.err <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">1</span>, lower <span class="op">=</span> <span class="fl">1</span>, .before <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Treatment <span class="op">=</span> <span class="va">trtf</span>, Study <span class="op">=</span> <span class="va">studyf</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sp</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">estimate</span>, colour <span class="op">=</span> <span class="va">Treatment</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.15</span>, data <span class="op">=</span> <span class="va">kmdat</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">estimate</span>, colour <span class="op">=</span> <span class="va">Treatment</span><span class="op">)</span>, stroke <span class="op">=</span> <span class="fl">0.15</span>, shape <span class="op">=</span> <span class="fl">3</span>,</span>
<span>             data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">kmdat</span>, <span class="va">n.censor</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/ndmm-survival-1.png" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="population-average-median-survival-times">Population-average median survival times<a class="anchor" aria-label="anchor" href="#population-average-median-survival-times"></a>
</h3>
<p>The <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function can produce a range of other
absolute effect summaries, for example population-average median
survival times:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">medsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ndmm_fit_1kt</span>, type <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Evaluating M-spline at times beyond the boundary knots.</span></span>
<span><span class="co">#&gt; Evaluating M-spline at times beyond the boundary knots.</span></span>
<span><span class="co">#&gt; Evaluating M-spline at times beyond the boundary knots.</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------- Study: Attal2012 ---- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                        mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; pred[Attal2012: Pbo]  28.70 1.58 25.71 27.61 28.66 29.78 31.89     4745     3841 1.00</span></span>
<span><span class="co">#&gt; pred[Attal2012: Len]  46.73 2.44 42.11 45.04 46.67 48.22 51.76     9315     3365 1.00</span></span>
<span><span class="co">#&gt; pred[Attal2012: Thal] 32.09 3.64 25.61 29.58 31.82 34.32 40.13     3745     3106 1.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ----------------------------------------------------------- Study: McCarthy2012 ---- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                           mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; pred[McCarthy2012: Pbo]  33.38 2.24 29.20 31.82 33.31 34.82 37.97     3962     3084 1.00</span></span>
<span><span class="co">#&gt; pred[McCarthy2012: Len]  56.00 3.14 50.08 53.83 55.87 58.05 62.39     5489     3362 1.00</span></span>
<span><span class="co">#&gt; pred[McCarthy2012: Thal] 38.53 4.49 30.22 35.47 38.41 41.43 47.67     3274     3168 1.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ Study: Palumbo2014 ---- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                          mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; pred[Palumbo2014: Pbo]  21.13 2.30 17.08 19.48 21.01 22.62 26.03     5413     3337    1</span></span>
<span><span class="co">#&gt; pred[Palumbo2014: Len]  45.00 5.10 35.93 41.48 44.80 48.07 54.91     6004     3412    1</span></span>
<span><span class="co">#&gt; pred[Palumbo2014: Thal] 26.60 4.76 18.58 23.22 26.15 29.44 37.10     4761     3278    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ Study: Jackson2019 ---- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                          mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; pred[Jackson2019: Pbo]  24.15 1.33 21.67 23.23 24.11 25.04 26.87     2566     3327 1.01</span></span>
<span><span class="co">#&gt; pred[Jackson2019: Len]  50.99 2.52 46.06 49.28 50.96 52.67 55.99       88     3022 1.03</span></span>
<span><span class="co">#&gt; pred[Jackson2019: Thal] 31.10 3.87 24.30 28.36 30.82 33.41 39.59     6238     3128 1.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------- Study: Morgan2012 ---- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                         mean    sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; pred[Morgan2012: Pbo]  20.73  1.91 17.26 19.39 20.62 21.96 24.76     2535     3344 1.01</span></span>
<span><span class="co">#&gt; pred[Morgan2012: Len]  49.95 70.67 37.84 44.01 47.84 52.12 64.21      770     3185 1.01</span></span>
<span><span class="co">#&gt; pred[Morgan2012: Thal] 27.34  2.43 22.93 25.65 27.22 28.89 32.42     5881     3470 1.00</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">medsurv</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/ndmm-median-survival-1.png" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="population-average-conditional-log-hazard-ratios">Population-average conditional log hazard ratios<a class="anchor" aria-label="anchor" href="#population-average-conditional-log-hazard-ratios"></a>
</h3>
<p>Relative effects are produced using the
<code><a href="../reference/relative_effects.html">relative_effects()</a></code> function. With a ML-NMR model (or an IPD
meta-regression), these are population-average conditional log hazard
ratios (or log survival time ratios for AFT models).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">loghr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relative_effects.html">relative_effects</a></span><span class="op">(</span><span class="va">ndmm_fit_1kt</span>, all_contrasts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------- Study: Attal2012 ---- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Covariate values:</span></span>
<span><span class="co">#&gt;    age iss_stage3 response_cr_vgpr male</span></span>
<span><span class="co">#&gt;  54.29        0.2             0.54 0.57</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                             mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; d[Attal2012: Len vs. Pbo]  -0.59 0.07 -0.74 -0.64 -0.59 -0.54 -0.45     6206     3113 1.00</span></span>
<span><span class="co">#&gt; d[Attal2012: Thal vs. Pbo] -0.12 0.13 -0.39 -0.21 -0.12 -0.03  0.14     4379     3188 1.01</span></span>
<span><span class="co">#&gt; d[Attal2012: Thal vs. Len]  0.47 0.12  0.23  0.39  0.47  0.55  0.70     1026     3072 1.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ----------------------------------------------------------- Study: McCarthy2012 ---- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Covariate values:</span></span>
<span><span class="co">#&gt;    age iss_stage3 response_cr_vgpr male</span></span>
<span><span class="co">#&gt;  57.66       0.23             0.67 0.54</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; d[McCarthy2012: Len vs. Pbo]  -0.62 0.06 -0.74 -0.66 -0.62 -0.58 -0.51     5733     3240 1.00</span></span>
<span><span class="co">#&gt; d[McCarthy2012: Thal vs. Pbo] -0.15 0.12 -0.39 -0.23 -0.15 -0.07  0.08     4199     2973 1.01</span></span>
<span><span class="co">#&gt; d[McCarthy2012: Thal vs. Len]  0.47 0.12  0.23  0.39  0.47  0.55  0.70     1026     3072 1.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ Study: Palumbo2014 ---- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Covariate values:</span></span>
<span><span class="co">#&gt;    age iss_stage3 response_cr_vgpr male</span></span>
<span><span class="co">#&gt;  54.17       0.11              0.4 0.55</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                               mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; d[Palumbo2014: Len vs. Pbo]  -0.64 0.08 -0.80 -0.69 -0.64 -0.58 -0.48     6475     3111 1.00</span></span>
<span><span class="co">#&gt; d[Palumbo2014: Thal vs. Pbo] -0.17 0.14 -0.45 -0.26 -0.17 -0.08  0.11     4947     3204 1.01</span></span>
<span><span class="co">#&gt; d[Palumbo2014: Thal vs. Len]  0.47 0.12  0.23  0.39  0.47  0.55  0.70     1026     3072 1.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ Study: Jackson2019 ---- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Covariate values:</span></span>
<span><span class="co">#&gt;    age iss_stage3 response_cr_vgpr male</span></span>
<span><span class="co">#&gt;  64.63       0.21             0.84 0.62</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                               mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; d[Jackson2019: Len vs. Pbo]  -0.70 0.06 -0.82 -0.74 -0.70 -0.65 -0.57     4415     3352 1.01</span></span>
<span><span class="co">#&gt; d[Jackson2019: Thal vs. Pbo] -0.23 0.11 -0.45 -0.30 -0.23 -0.15 -0.02     5473     2863 1.00</span></span>
<span><span class="co">#&gt; d[Jackson2019: Thal vs. Len]  0.47 0.12  0.23  0.39  0.47  0.55  0.70     1026     3072 1.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------- Study: Morgan2012 ---- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Covariate values:</span></span>
<span><span class="co">#&gt;    age iss_stage3 response_cr_vgpr male</span></span>
<span><span class="co">#&gt;  64.46       0.33             0.73 0.62</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                              mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS Tail_ESS Rhat</span></span>
<span><span class="co">#&gt; d[Morgan2012: Len vs. Pbo]  -0.69 0.06 -0.82 -0.74 -0.70 -0.65 -0.57     4724     3265 1.01</span></span>
<span><span class="co">#&gt; d[Morgan2012: Thal vs. Pbo] -0.22 0.10 -0.44 -0.29 -0.22 -0.15 -0.02     5072     2969 1.00</span></span>
<span><span class="co">#&gt; d[Morgan2012: Thal vs. Len]  0.47 0.12  0.23  0.39  0.47  0.55  0.70     1026     3072 1.01</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">loghr</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/ndmm-loghr-1.png" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Brilleman2020" class="csl-entry">
Brilleman, Samuel L., Eren M. Elci, Jacqueline Buros Novik, and Rory
Wolfe. 2020. <span>“Bayesian Survival Analysis Using the Rstanarm
<span>R</span> Package.”</span> <em>arXiv</em>, February. <a href="https://doi.org/10.48550/arXiv.2002.09633" class="external-link">https://doi.org/10.48550/arXiv.2002.09633</a>.
</div>
<div id="ref-Leahy2019" class="csl-entry">
Leahy, Joy, and Cathal Walsh. 2019. <span>“Assessing the Impact of a
Matching-Adjusted Indirect Comparison in a <span>Bayesian</span> Network
Meta-Analysis.”</span> <em>Research Synthesis Methods</em> 10 (4):
546–68. <a href="https://doi.org/10.1002/jrsm.1372" class="external-link">https://doi.org/10.1002/jrsm.1372</a>.
</div>
<div id="ref-TSD18" class="csl-entry">
Phillippo, D. M., A. E. Ades, S. Dias, S. Palmer, K. R. Abrams, and N.
J. Welton. 2016. <span>“<span>NICE DSU Technical Support Document</span>
18: Methods for Population-Adjusted Indirect Comparisons in Submission
to <span>NICE</span>.”</span> <span>National Institute for Health and
Care Excellence</span>. <a href="https://www.sheffield.ac.uk/nice-dsu" class="external-link">https://www.sheffield.ac.uk/nice-dsu</a>.
</div>
<div id="ref-methods_paper" class="csl-entry">
Phillippo, D. M., S. Dias, A. E. Ades, M. Belger, A. Brnabic, A.
Schacht, D. Saure, Z. Kadziola, and N. J. Welton. 2020.
<span>“Multilevel Network Meta-Regression for Population-Adjusted
Treatment Comparisons.”</span> <em>Journal of the Royal Statistical
Society: Series A (Statistics in Society)</em> 183 (3): 1189–1210. <a href="https://doi.org/10.1111/rssa.12579" class="external-link">https://doi.org/10.1111/rssa.12579</a>.
</div>
<div id="ref-Phillippo_survival" class="csl-entry">
Phillippo, D. M., S. Dias, A. E. Ades, and N. J. Welton. n.d.
<span>“Extension of Multilevel Network Meta-Regression to General
Likelihoods: Synthesis of Individual and Aggregate Data with
Applications to Survival Analysis.”</span>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David M. Phillippo.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  <script data-goatcounter="https://multinma.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
