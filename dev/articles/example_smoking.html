<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example: Smoking cessation • multinma</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Example: Smoking cessation">
<meta property="og:description" content="multinma">
<meta property="og:image" content="https://dmphillippo.github.io/multinma/logo.svg">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multinma</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette_overview.html">Overview of Examples</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Examples</li>
    <li>
      <a href="../articles/example_atrial_fibrillation.html">Example: Atrial fibrillation</a>
    </li>
    <li>
      <a href="../articles/example_bcg_vaccine.html">Example: BCG vaccine for tuberculosis</a>
    </li>
    <li>
      <a href="../articles/example_blocker.html">Example: Beta blockers</a>
    </li>
    <li>
      <a href="../articles/example_diabetes.html">Example: Diabetes</a>
    </li>
    <li>
      <a href="../articles/example_dietary_fat.html">Example: Dietary fat</a>
    </li>
    <li>
      <a href="../articles/example_hta_psoriasis.html">Example: Plaque psoriasis HTA report</a>
    </li>
    <li>
      <a href="../articles/example_parkinsons.html">Example: Parkinson's disease</a>
    </li>
    <li>
      <a href="../articles/example_plaque_psoriasis.html">Example: Plaque psoriasis ML-NMR</a>
    </li>
    <li>
      <a href="../articles/example_smoking.html">Example: Smoking cessation</a>
    </li>
    <li>
      <a href="../articles/example_statins.html">Example: Statins for cholesterol lowering</a>
    </li>
    <li>
      <a href="../articles/example_thrombolytics.html">Example: Thrombolytic treatments</a>
    </li>
    <li>
      <a href="../articles/example_transfusion.html">Example: White blood cell transfusion</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dmphillippo/multinma/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example_smoking_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="example_smoking_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="example_smoking_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example: Smoking cessation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dmphillippo/multinma/blob/master/vignettes/example_smoking.Rmd"><code>vignettes/example_smoking.Rmd</code></a></small>
      <div class="hidden name"><code>example_smoking.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dmphillippo.github.io/multinma/">multinma</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; For execution on a local, multicore CPU with excess RAM we recommend calling
#&gt; options(mc.cores = parallel::detectCores())
#&gt; 
#&gt; Attaching package: 'multinma'
#&gt; The following objects are masked from 'package:stats':
#&gt; 
#&gt;     dgamma, pgamma, qgamma</code></pre>
<p>This vignette describes the analysis of smoking cessation data <span class="citation">(Hasselblad 1998)</span>, replicating the analysis in NICE Technical Support Document 4 <span class="citation">(Dias et al. 2011)</span>. The data are available in this package as <code>smoking</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">smoking</span><span class="op">)</span>
<span class="co">#&gt;   studyn trtn                   trtc  r   n</span>
<span class="co">#&gt; 1      1    1        No intervention  9 140</span>
<span class="co">#&gt; 2      1    3 Individual counselling 23 140</span>
<span class="co">#&gt; 3      1    4      Group counselling 10 138</span>
<span class="co">#&gt; 4      2    2              Self-help 11  78</span>
<span class="co">#&gt; 5      2    3 Individual counselling 12  85</span>
<span class="co">#&gt; 6      2    4      Group counselling 29 170</span></code></pre></div>
<div id="setting-up-the-network" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-the-network" class="anchor"></a>Setting up the network</h3>
<p>We begin by setting up the network. We have arm-level count data giving the number quitting smoking (<code>r</code>) out of the total (<code>n</code>) in each arm, so we use the function <code><a href="../reference/set_agd_arm.html">set_agd_arm()</a></code>. Treatment “No intervention” is set as the network reference treatment.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smknet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_agd_arm.html">set_agd_arm</a></span><span class="op">(</span><span class="va">smoking</span>, 
                      study <span class="op">=</span> <span class="va">studyn</span>,
                      trt <span class="op">=</span> <span class="va">trtc</span>,
                      r <span class="op">=</span> <span class="va">r</span>, 
                      n <span class="op">=</span> <span class="va">n</span>,
                      trt_ref <span class="op">=</span> <span class="st">"No intervention"</span><span class="op">)</span>
<span class="va">smknet</span>
<span class="co">#&gt; A network with 24 AgD studies (arm-based).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ------------------------------------------------------- AgD studies (arm-based) ---- </span>
<span class="co">#&gt;  Study Treatments                                                     </span>
<span class="co">#&gt;  1     3: No intervention | Individual counselling | Group counselling</span>
<span class="co">#&gt;  2     3: Self-help | Individual counselling | Group counselling      </span>
<span class="co">#&gt;  3     2: No intervention | Individual counselling                    </span>
<span class="co">#&gt;  4     2: No intervention | Individual counselling                    </span>
<span class="co">#&gt;  5     2: No intervention | Individual counselling                    </span>
<span class="co">#&gt;  6     2: No intervention | Individual counselling                    </span>
<span class="co">#&gt;  7     2: No intervention | Individual counselling                    </span>
<span class="co">#&gt;  8     2: No intervention | Individual counselling                    </span>
<span class="co">#&gt;  9     2: No intervention | Individual counselling                    </span>
<span class="co">#&gt;  10    2: No intervention | Self-help                                 </span>
<span class="co">#&gt;  ... plus 14 more studies</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Outcome type: count</span>
<span class="co">#&gt; ------------------------------------------------------------------------------------</span>
<span class="co">#&gt; Total number of treatments: 4</span>
<span class="co">#&gt; Total number of studies: 24</span>
<span class="co">#&gt; Reference treatment is: No intervention</span>
<span class="co">#&gt; Network is connected</span></code></pre></div>
<p>Plot the network structure.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">smknet</span>, weight_edges <span class="op">=</span> <span class="cn">TRUE</span>, weight_nodes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="example_smoking_files/figure-html/smoking_network_plot-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div id="random-effects-nma" class="section level3">
<h3 class="hasAnchor">
<a href="#random-effects-nma" class="anchor"></a>Random effects NMA</h3>
<p>Following TSD 4, we fit a random effects NMA model, using the <code><a href="../reference/nma.html">nma()</a></code> function with <code>trt_effects = "random"</code>. We use <span class="math inline">\(\mathrm{N}(0, 100^2)\)</span> prior distributions for the treatment effects <span class="math inline">\(d_k\)</span> and study-specific intercepts <span class="math inline">\(\mu_j\)</span>, and a <span class="math inline">\(\textrm{half-N}(5^2)\)</span> prior distribution for the between-study heterogeneity standard deviation <span class="math inline">\(\tau\)</span>. We can examine the range of parameter values implied by these prior distributions with the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; A Normal prior distribution: location = 0, scale = 100.</span>
<span class="co">#&gt; 50% of the prior density lies between -67.45 and 67.45.</span>
<span class="co">#&gt; 95% of the prior density lies between -196 and 196.</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/priors.html">half_normal</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; A half-Normal prior distribution: location = 0, scale = 5.</span>
<span class="co">#&gt; 50% of the prior density lies between 0 and 3.37.</span>
<span class="co">#&gt; 95% of the prior density lies between 0 and 9.8.</span></code></pre></div>
<p>The model is fitted using the <code><a href="../reference/nma.html">nma()</a></code> function. By default, this will use a Binomial likelihood and a logit link function, auto-detected from the data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smkfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">smknet</span>, 
              trt_effects <span class="op">=</span> <span class="st">"random"</span>,
              prior_intercept <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,
              prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,
              prior_het <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Basic parameter summaries are given by the <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> method:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smkfit</span>
<span class="co">#&gt; A random effects NMA with a binomial likelihood (logit link).</span>
<span class="co">#&gt; Inference for Stan model: binomial_1par.</span>
<span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                               mean se_mean   sd     2.5%      25%      50%      75%    97.5% n_eff</span>
<span class="co">#&gt; d[Group counselling]          1.10    0.01 0.42     0.29     0.82     1.09     1.37     1.97  2062</span>
<span class="co">#&gt; d[Individual counselling]     0.85    0.01 0.24     0.41     0.70     0.84     1.00     1.36  1377</span>
<span class="co">#&gt; d[Self-help]                  0.50    0.01 0.40    -0.26     0.25     0.50     0.76     1.30  2162</span>
<span class="co">#&gt; lp__                      -5768.05    0.19 6.34 -5781.24 -5772.10 -5767.70 -5763.65 -5756.42  1118</span>
<span class="co">#&gt; tau                           0.84    0.01 0.18     0.55     0.71     0.81     0.94     1.25  1295</span>
<span class="co">#&gt;                           Rhat</span>
<span class="co">#&gt; d[Group counselling]         1</span>
<span class="co">#&gt; d[Individual counselling]    1</span>
<span class="co">#&gt; d[Self-help]                 1</span>
<span class="co">#&gt; lp__                         1</span>
<span class="co">#&gt; tau                          1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Fri Dec  4 12:14:45 2020.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span></code></pre></div>
<p>By default, summaries of the study-specific intercepts <span class="math inline">\(\mu_j\)</span> and study-specific relative effects <span class="math inline">\(\delta_{jk}\)</span> are hidden, but could be examined by changing the <code>pars</code> argument:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Not run</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">smkfit</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"tau"</span>, <span class="st">"mu"</span>, <span class="st">"delta"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The prior and posterior distributions can be compared visually using the <code><a href="../reference/plot_prior_posterior.html">plot_prior_posterior()</a></code> function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_prior_posterior.html">plot_prior_posterior</a></span><span class="op">(</span><span class="va">smkfit</span><span class="op">)</span></code></pre></div>
<p><img src="example_smoking_files/figure-html/smoking_pp_plot-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>By default, this displays all model parameters given prior distributions (in this case <span class="math inline">\(d_k\)</span>, <span class="math inline">\(\mu_j\)</span>, and <span class="math inline">\(\tau\)</span>), but this may be changed using the <code>prior</code> argument:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_prior_posterior.html">plot_prior_posterior</a></span><span class="op">(</span><span class="va">smkfit</span>, prior <span class="op">=</span> <span class="st">"het"</span><span class="op">)</span></code></pre></div>
<p><img src="example_smoking_files/figure-html/smoking_pp_plot_tau-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Model fit can be checked using the <code><a href="../reference/dic.html">dic()</a></code> function</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dic_consistency</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">smkfit</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Residual deviance: 54.1 (on 50 data points)</span>
<span class="co">#&gt;                pD: 43.8</span>
<span class="co">#&gt;               DIC: 97.9</span></code></pre></div>
<p>and the residual deviance contributions examined with the corresponding <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dic_consistency</span><span class="op">)</span></code></pre></div>
<p><img src="example_smoking_files/figure-html/smoking_resdev_plot-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Overall model fit seems to be adequate, with almost all points showing good fit (mean residual deviance contribution of 1). The only two points with higher residual deviance (i.e. worse fit) correspond to the two zero counts in the data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking</span><span class="op">[</span><span class="va">smoking</span><span class="op">$</span><span class="va">r</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span>
<span class="co">#&gt;    studyn trtn            trtc r  n</span>
<span class="co">#&gt; 13      6    1 No intervention 0 33</span>
<span class="co">#&gt; 31     15    1 No intervention 0 20</span></code></pre></div>
</div>
<div id="checking-for-inconsistency" class="section level3">
<h3 class="hasAnchor">
<a href="#checking-for-inconsistency" class="anchor"></a>Checking for inconsistency</h3>
<p>We fit an unrelated mean effects (UME) model <span class="citation">(Dias et al. 2011)</span> to assess the consistency assumption. Again, we use the function <code><a href="../reference/nma.html">nma()</a></code>, but now with the argument <code>consistency = "ume"</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smkfit_ume</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.html">nma</a></span><span class="op">(</span><span class="va">smknet</span>, 
                  consistency <span class="op">=</span> <span class="st">"ume"</span>,
                  trt_effects <span class="op">=</span> <span class="st">"random"</span>,
                  prior_intercept <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,
                  prior_trt <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,
                  prior_het <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="va">smkfit_ume</span>
<span class="co">#&gt; A random effects NMA with a binomial likelihood (logit link).</span>
<span class="co">#&gt; An inconsistency model ('ume') was fitted.</span>
<span class="co">#&gt; Inference for Stan model: binomial_1par.</span>
<span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                                                     mean se_mean   sd     2.5%      25%      50%</span>
<span class="co">#&gt; d[Group counselling vs. No intervention]            1.12    0.02 0.80    -0.40     0.59     1.09</span>
<span class="co">#&gt; d[Individual counselling vs. No intervention]       0.90    0.01 0.27     0.42     0.72     0.89</span>
<span class="co">#&gt; d[Self-help vs. No intervention]                    0.35    0.01 0.60    -0.87    -0.02     0.35</span>
<span class="co">#&gt; d[Individual counselling vs. Group counselling]    -0.29    0.01 0.61    -1.49    -0.67    -0.28</span>
<span class="co">#&gt; d[Self-help vs. Group counselling]                 -0.59    0.02 0.73    -2.02    -1.06    -0.60</span>
<span class="co">#&gt; d[Self-help vs. Individual counselling]             0.16    0.02 1.05    -1.89    -0.54     0.14</span>
<span class="co">#&gt; lp__                                            -5765.51    0.20 6.43 -5779.02 -5769.57 -5765.25</span>
<span class="co">#&gt; tau                                                 0.93    0.01 0.23     0.58     0.76     0.90</span>
<span class="co">#&gt;                                                      75%    97.5% n_eff Rhat</span>
<span class="co">#&gt; d[Group counselling vs. No intervention]            1.62     2.73  2735    1</span>
<span class="co">#&gt; d[Individual counselling vs. No intervention]       1.07     1.45  1197    1</span>
<span class="co">#&gt; d[Self-help vs. No intervention]                    0.72     1.54  1891    1</span>
<span class="co">#&gt; d[Individual counselling vs. Group counselling]     0.08     0.98  2271    1</span>
<span class="co">#&gt; d[Self-help vs. Group counselling]                 -0.15     0.88  1984    1</span>
<span class="co">#&gt; d[Self-help vs. Individual counselling]             0.83     2.29  3748    1</span>
<span class="co">#&gt; lp__                                            -5761.06 -5753.76  1063    1</span>
<span class="co">#&gt; tau                                                 1.06     1.50   989    1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Fri Dec  4 12:14:59 2020.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span></code></pre></div>
<p>Comparing the model fit statistics</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dic_consistency</span>
<span class="co">#&gt; Residual deviance: 54.1 (on 50 data points)</span>
<span class="co">#&gt;                pD: 43.8</span>
<span class="co">#&gt;               DIC: 97.9</span>
<span class="op">(</span><span class="va">dic_ume</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dic.html">dic</a></span><span class="op">(</span><span class="va">smkfit_ume</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Residual deviance: 53.9 (on 50 data points)</span>
<span class="co">#&gt;                pD: 45.1</span>
<span class="co">#&gt;               DIC: 99</span></code></pre></div>
<p>We see that there is little to choose between the two models. However, it is also important to examine the individual contributions to model fit of each data point under the two models (a so-called “dev-dev” plot). Passing two <code>nma_dic</code> objects produced by the <code><a href="../reference/dic.html">dic()</a></code> function to the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method produces this dev-dev plot:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dic_consistency</span>, <span class="va">dic_ume</span>, point_alpha <span class="op">=</span> <span class="fl">0.5</span>, interval_alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></code></pre></div>
<p><img src="example_smoking_files/figure-html/smoking_devdev_plot-1.png" width="700" style="display: block; margin: auto;"></p>
<p>All points lie roughly on the line of equality, so there is no evidence for inconsistency here.</p>
</div>
<div id="further-results" class="section level3">
<h3 class="hasAnchor">
<a href="#further-results" class="anchor"></a>Further results</h3>
<p>Pairwise relative effects, for all pairwise contrasts with <code>all_contrasts = TRUE</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">smk_releff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relative_effects.html">relative_effects</a></span><span class="op">(</span><span class="va">smkfit</span>, all_contrasts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                                                  mean   sd  2.5%   25%   50%   75% 97.5% Bulk_ESS</span>
<span class="co">#&gt; d[Group counselling vs. No intervention]         1.10 0.42  0.29  0.82  1.09  1.37  1.97     2090</span>
<span class="co">#&gt; d[Individual counselling vs. No intervention]    0.85 0.24  0.41  0.70  0.84  1.00  1.36     1413</span>
<span class="co">#&gt; d[Self-help vs. No intervention]                 0.50 0.40 -0.26  0.25  0.50  0.76  1.30     2184</span>
<span class="co">#&gt; d[Individual counselling vs. Group counselling] -0.25 0.40 -1.03 -0.52 -0.25  0.01  0.53     2915</span>
<span class="co">#&gt; d[Self-help vs. Group counselling]              -0.60 0.47 -1.56 -0.92 -0.60 -0.28  0.29     3014</span>
<span class="co">#&gt; d[Self-help vs. Individual counselling]         -0.35 0.41 -1.17 -0.61 -0.34 -0.09  0.46     2426</span>
<span class="co">#&gt;                                                 Tail_ESS Rhat</span>
<span class="co">#&gt; d[Group counselling vs. No intervention]            2409    1</span>
<span class="co">#&gt; d[Individual counselling vs. No intervention]       1869    1</span>
<span class="co">#&gt; d[Self-help vs. No intervention]                    2452    1</span>
<span class="co">#&gt; d[Individual counselling vs. Group counselling]     2789    1</span>
<span class="co">#&gt; d[Self-help vs. Group counselling]                  2722    1</span>
<span class="co">#&gt; d[Self-help vs. Individual counselling]             2276    1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">smk_releff</span>, ref_line <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p><img src="example_smoking_files/figure-html/smoking_releff-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Treatment rankings, rank probabilities, and cumulative rank probabilities. We set <code>lower_better = FALSE</code> since a higher log odds of cessation is better (the outcome is positive).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">smk_ranks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_ranks.html">posterior_ranks</a></span><span class="op">(</span><span class="va">smkfit</span>, lower_better <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                              mean   sd 2.5% 25% 50% 75% 97.5% Bulk_ESS Tail_ESS Rhat</span>
<span class="co">#&gt; rank[No intervention]        3.90 0.30    3   4   4   4     4     2650       NA    1</span>
<span class="co">#&gt; rank[Group counselling]      1.36 0.61    1   1   1   2     3     2870     2952    1</span>
<span class="co">#&gt; rank[Individual counselling] 1.92 0.62    1   2   2   2     3     2517     2624    1</span>
<span class="co">#&gt; rank[Self-help]              2.81 0.67    1   3   3   3     4     2670       NA    1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">smk_ranks</span><span class="op">)</span></code></pre></div>
<p><img src="example_smoking_files/figure-html/smoking_ranks-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">smk_rankprobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_ranks.html">posterior_rank_probs</a></span><span class="op">(</span><span class="va">smkfit</span>, lower_better <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                           p_rank[1] p_rank[2] p_rank[3] p_rank[4]</span>
<span class="co">#&gt; d[No intervention]             0.00      0.00      0.10      0.90</span>
<span class="co">#&gt; d[Group counselling]           0.71      0.22      0.06      0.00</span>
<span class="co">#&gt; d[Individual counselling]      0.23      0.61      0.16      0.00</span>
<span class="co">#&gt; d[Self-help]                   0.06      0.17      0.68      0.09</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">smk_rankprobs</span><span class="op">)</span></code></pre></div>
<p><img src="example_smoking_files/figure-html/smoking_rankprobs-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">smk_cumrankprobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_ranks.html">posterior_rank_probs</a></span><span class="op">(</span><span class="va">smkfit</span>, lower_better <span class="op">=</span> <span class="cn">FALSE</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                           p_rank[1] p_rank[2] p_rank[3] p_rank[4]</span>
<span class="co">#&gt; d[No intervention]             0.00      0.00      0.10         1</span>
<span class="co">#&gt; d[Group counselling]           0.71      0.93      1.00         1</span>
<span class="co">#&gt; d[Individual counselling]      0.23      0.84      1.00         1</span>
<span class="co">#&gt; d[Self-help]                   0.06      0.22      0.91         1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">smk_cumrankprobs</span><span class="op">)</span></code></pre></div>
<p><img src="example_smoking_files/figure-html/smoking_cumrankprobs-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-TSD4">
<p>Dias, S., N. J. Welton, A. J. Sutton, D. M. Caldwell, G. Lu, and A. E. Ades. 2011. “NICE DSU Technical Support Document 4: Inconsistency in Networks of Evidence Based on Randomised Controlled Trials.” National Institute for Health and Care Excellence. <a href="http://nicedsu.org.uk/">http://nicedsu.org.uk/</a>.</p>
</div>
<div id="ref-Hasselblad1998">
<p>Hasselblad, V. 1998. “Meta-Analysis of Multitreatment Studies.” <em>Medical Decision Making</em> 18 (1): 37–43. <a href="https://doi.org/10.1177/0272989x9801800110">https://doi.org/10.1177/0272989x9801800110</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David M. Phillippo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
