<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The add_integration() generic creates numerical integration points using a
Gaussian copula approach, as described in
Phillippo et al. (2020)
. Methods are available for
networks stored in nma_data objects, and for data frames. The function
unnest_integration() unnests integration points stored in a data frame, to
aid plotting or other exploration."><title>Add numerical integration points to aggregate data — add_integration • multinma</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Source%20Sans%20Pro-0.4.0/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Add numerical integration points to aggregate data — add_integration"><meta property="og:description" content="The add_integration() generic creates numerical integration points using a
Gaussian copula approach, as described in
Phillippo et al. (2020)
. Methods are available for
networks stored in nma_data objects, and for data frames. The function
unnest_integration() unnests integration points stored in a data frame, to
aid plotting or other exploration."><meta property="og:image" content="https://dmphillippo.github.io/multinma/logo.svg"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">multinma</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette_overview.html">Overview of Examples</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Examples</h6>
    <a class="dropdown-item" href="../articles/example_atrial_fibrillation.html">Example: Atrial fibrillation</a>
    <a class="dropdown-item" href="../articles/example_bcg_vaccine.html">Example: BCG vaccine for tuberculosis</a>
    <a class="dropdown-item" href="../articles/example_blocker.html">Example: Beta blockers</a>
    <a class="dropdown-item" href="../articles/example_diabetes.html">Example: Diabetes</a>
    <a class="dropdown-item" href="../articles/example_dietary_fat.html">Example: Dietary fat</a>
    <a class="dropdown-item" href="../articles/example_hta_psoriasis.html">Example: Plaque psoriasis HTA report</a>
    <a class="dropdown-item" href="../articles/example_parkinsons.html">Example: Parkinson's disease</a>
    <a class="dropdown-item" href="../articles/example_plaque_psoriasis.html">Example: Plaque psoriasis ML-NMR</a>
    <a class="dropdown-item" href="../articles/example_smoking.html">Example: Smoking cessation</a>
    <a class="dropdown-item" href="../articles/example_statins.html">Example: Statins for cholesterol lowering</a>
    <a class="dropdown-item" href="../articles/example_thrombolytics.html">Example: Thrombolytic treatments</a>
    <a class="dropdown-item" href="../articles/example_transfusion.html">Example: White blood cell transfusion</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dmphillippo/multinma/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Add numerical integration points to aggregate data</h1>
      <small class="dont-index">Source: <a href="https://github.com/dmphillippo/multinma/blob/HEAD/R/integration.R" class="external-link"><code>R/integration.R</code></a></small>
      <div class="d-none name"><code>add_integration.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>add_integration()</code> generic creates numerical integration points using a
Gaussian copula approach, as described in
Phillippo et al. (2020)
. Methods are available for
networks stored in <code>nma_data</code> objects, and for data frames. The function
<code>unnest_integration()</code> unnests integration points stored in a data frame, to
aid plotting or other exploration.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">add_integration</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S3 method for default</span>
<span class="fu">add_integration</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S3 method for data.frame</span>
<span class="fu">add_integration</span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">...</span>,
  cor <span class="op">=</span> <span class="cn">NULL</span>,
  cor_adjust <span class="op">=</span> <span class="cn">NULL</span>,
  n_int <span class="op">=</span> <span class="fl">1000L</span>,
  int_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># S3 method for nma_data</span>
<span class="fu">add_integration</span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">...</span>,
  cor <span class="op">=</span> <span class="cn">NULL</span>,
  cor_adjust <span class="op">=</span> <span class="cn">NULL</span>,
  n_int <span class="op">=</span> <span class="fl">1000L</span>,
  int_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu">unnest_integration</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>An <code>nma_data</code> object, as created by the <code>set_*()</code> functions or
<code><a href="combine_network.html">combine_network()</a></code>, or data frame</p></dd>
<dt>...</dt>
<dd><p>Distributions for covariates, see "Details"</p></dd>
<dt>cor</dt>
<dd><p>Correlation matrix to use for generating the integration points.
By default, this takes a weighted correlation matrix from all IPD studies.
Rows and columns should match the order of covariates specified in <code>...</code>.</p></dd>
<dt>cor_adjust</dt>
<dd><p>Adjustment to apply to the correlation matrix given by
<code>cor</code> (or computed from the IPD if <code>cor = NULL</code>) to obtain the Gaussian
copula correlations, either <code>"spearman"</code>, <code>"pearson"</code>, or <code>"none"</code>, see
"Details". The default when <code>cor = NULL</code> is <code>"spearman"</code>, otherwise the
default is <code>"pearson"</code>.</p></dd>
<dt>n_int</dt>
<dd><p>Number of integration points to generate, default 1000</p></dd>
<dt>int_args</dt>
<dd><p>A named list of arguments to pass to
<code><a href="https://rdrr.io/pkg/randtoolbox/man/quasiRNG.html" class="external-link">sobol()</a></code></p></dd>
<dt>data</dt>
<dd><p>Data frame with nested integration points, stored in list
columns as <code>.int_&lt;variable name&gt;</code></p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For the <code>nma_data</code> method, an object of class <a href="nma_data-class.html">nma_data</a>. For the
<code>data.frame</code> method, the input data frame is returned (as a <a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a>) with
an added column for each covariate (prefixed with ".int_"), containing the
numerical integration points nested as length-<code>n_int</code> vectors within each
row. For <code>unnest_integration()</code>, a data frame with integration points
unnested.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The arguments passed to <code>...</code> specify distributions for the
covariates. Argument names specify the name of the covariate, which should
match a covariate name in the IPD (if IPD are present). The required
marginal distribution is then specified using the function <code><a href="distr.html">distr()</a></code>.</p>
<p>The argument <code>cor_adjust</code> specifies how the correlation matrix given by
<code>cor</code> (or computed from the IPD if <code>cor = NULL</code>) is adjusted to obtain the
correlation matrix for the Gaussian copula, using the formulae in
Xiao and Zhou (2018)
.</p><ul><li><p><code>cor_adjust = "spearman"</code> should be used when the correlations <code>cor</code> have
been computed using Spearman's rank correlation. Correlations between
continuous covariates will be reproduced exactly by the integration points.
Correlations between discrete covariates will be reproduced approximately.
This is the default when <code>cor = NULL</code> and correlations are calculated from
the IPD studies.</p></li>
<li><p><code>cor_adjust = "pearson"</code> should be used when the correlations <code>cor</code> have
been computed using Pearson's product-moment correlation. Correlations between
Normal covariates will be reproduced exactly by the integration points, all
others will be reproduced approximately. Correlations between discrete
covariates will be reproduced approximately (and identically to <code>cor_adjust   = "spearman"</code>). This is the default when <code>cor</code> is provided by the user,
since <code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor()</a></code> defaults to <code>method = "pearson"</code> and Pearson correlations are
most likely reported in published data. However, we recommend providing
Spearman correlations (e.g. from <code>cor(., method = "spearman")</code>) and using
<code>cor_adjust = "spearman"</code> where possible.</p></li>
<li><p><code>cor_adjust = "none"</code> allows the user to specify the correlation matrix
for the Gaussian copula directly; no adjustment is applied.</p></li>
<li><p><code>cor_adjust = "legacy"</code> is also available, which reproduces exactly the
behaviour from version 0.3.0 and earlier. This is similar to <code>cor_adjust =   "none"</code>, but unadjusted Spearman correlations are used if <code>cor = NULL</code>.</p></li>
</ul><p>When adding integration points to a network object the correlation matrix
used is stored in <code>$int_cor</code>, and the copula correlation matrix and
adjustment used are stored as attributes of <code>$int_cor</code>. If this correlation
matrix is passed again to <code>add_integration()</code> (e.g. to reuse the
correlations for an external target population) this will be detected, and
the correct setting for <code>cor_adjust</code> will automatically be applied.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Phillippo DM, Dias S, Ades AE, Belger M, Brnabic A, Schacht A, Saure D, Kadziola Z, Welton NJ (2020).
“Multilevel Network Meta-Regression for population-adjusted treatment comparisons.”
<em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em>, <b>183</b>(3), 1189--1210.
doi: <a href="https://doi.org/10.1111/rssa.12579" class="external-link">10.1111/rssa.12579</a>
.<br><br> Xiao Q, Zhou S (2018).
“Matching a correlation coefficient by a Gaussian copula.”
<em>Communications in Statistics - Theory and Methods</em>, <b>48</b>(7), 1728--1747.
doi: <a href="https://doi.org/10.1080/03610926.2018.1439962" class="external-link">10.1080/03610926.2018.1439962</a>
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">## Plaque psoriasis ML-NMR - network setup and adding integration points</span></span>
<span class="r-in"><span class="co"># Set up plaque psoriasis network combining IPD and AgD</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span class="r-in"><span class="va">pso_ipd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">plaque_psoriasis_ipd</span>,</span>
<span class="r-in">                  <span class="va">studyc</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UNCOVER-1"</span>, <span class="st">"UNCOVER-2"</span>, <span class="st">"UNCOVER-3"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">pso_agd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">plaque_psoriasis_agd</span>,</span>
<span class="r-in">                  <span class="va">studyc</span> <span class="op">==</span> <span class="st">"FIXTURE"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pso_ipd</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      studyc      trtc_long    trtc trtn pasi75 pasi90 pasi100 age  bmi pasi_w0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 UNCOVER-1 Ixekizumab Q2W IXE_Q2W    2      0      0       0  34 32.2    18.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 UNCOVER-1 Ixekizumab Q2W IXE_Q2W    2      1      0       0  64 41.9    23.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 UNCOVER-1 Ixekizumab Q2W IXE_Q2W    2      1      1       0  42 26.2    12.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 UNCOVER-1 Ixekizumab Q2W IXE_Q2W    2      0      0       0  45 52.9    36.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 UNCOVER-1 Ixekizumab Q2W IXE_Q2W    2      1      0       0  67 22.9    20.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 UNCOVER-1 Ixekizumab Q2W IXE_Q2W    2      1      1       1  57 22.4    18.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    male bsa weight durnpso prevsys   psa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  TRUE  18   98.1     6.7    TRUE  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  TRUE  33  129.6    14.5   FALSE  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  TRUE  33   78.0    26.5    TRUE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 FALSE  50  139.9    25.0    TRUE  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 FALSE  35   54.2    11.9    TRUE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  TRUE  29   67.5    15.2    TRUE FALSE</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pso_agd</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    studyc          trtc_long    trtc trtn pasi75_r pasi75_n pasi90_r pasi90_n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 FIXTURE         Etanercept     ETN    4      142      323       67      323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 FIXTURE            Placebo     PBO    1       16      324        5      324</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 FIXTURE Secukinumab 150 mg SEC_150    5      219      327      137      327</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 FIXTURE Secukinumab 300 mg SEC_300    6      249      323      175      323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pasi100_r pasi100_n sample_size_w0 age_mean age_sd bmi_mean bmi_sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        14       323            326     43.8   13.0     28.7    5.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         0       324            326     44.1   12.6     27.9    6.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        47       327            327     45.4   12.9     28.4    5.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        78       323            327     44.5   13.2     28.4    6.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pasi_w0_mean pasi_w0_sd male bsa_mean bsa_sd weight_mean weight_sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         23.2        9.8 71.2     33.6   18.0        84.6      20.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         24.1       10.5 72.7     35.2   19.1        82.0      20.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         23.7       10.5 72.2     34.5   19.4        83.6      20.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         23.9        9.9 68.5     34.3   19.2        83.0      21.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   durnpso_mean durnpso_sd prevsys  psa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         16.4       12.0    65.6 13.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         16.6       11.6    62.6 15.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         17.3       12.2    64.8 15.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         15.8       12.3    63.0 15.3</span>
<span class="r-in"></span>
<span class="r-in"><span class="va">pso_ipd</span> <span class="op">&lt;-</span> <span class="va">pso_ipd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="co"># Variable transformations</span></span>
<span class="r-in">    bsa <span class="op">=</span> <span class="va">bsa</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span class="r-in">    prevsys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">prevsys</span><span class="op">)</span>,</span>
<span class="r-in">    psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">psa</span><span class="op">)</span>,</span>
<span class="r-in">    weight <span class="op">=</span> <span class="va">weight</span> <span class="op">/</span> <span class="fl">10</span>,</span>
<span class="r-in">    durnpso <span class="op">=</span> <span class="va">durnpso</span> <span class="op">/</span> <span class="fl">10</span>,</span>
<span class="r-in">    <span class="co"># Treatment classes</span></span>
<span class="r-in">    trtclass <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">trtn</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Placebo"</span>,</span>
<span class="r-in">                         <span class="va">trtn</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span> <span class="op">~</span> <span class="st">"IL blocker"</span>,</span>
<span class="r-in">                         <span class="va">trtn</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">~</span> <span class="st">"TNFa blocker"</span><span class="op">)</span>,</span>
<span class="r-in">    <span class="co"># Check complete cases for covariates of interest</span></span>
<span class="r-in">    complete <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">durnpso</span>, <span class="va">prevsys</span>, <span class="va">bsa</span>, <span class="va">weight</span>, <span class="va">psa</span><span class="op">)</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">pso_agd</span> <span class="op">&lt;-</span> <span class="va">pso_agd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span class="r-in">    <span class="co"># Variable transformations</span></span>
<span class="r-in">    bsa_mean <span class="op">=</span> <span class="va">bsa_mean</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span class="r-in">    bsa_sd <span class="op">=</span> <span class="va">bsa_sd</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span class="r-in">    prevsys <span class="op">=</span> <span class="va">prevsys</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span class="r-in">    psa <span class="op">=</span> <span class="va">psa</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span class="r-in">    weight_mean <span class="op">=</span> <span class="va">weight_mean</span> <span class="op">/</span> <span class="fl">10</span>,</span>
<span class="r-in">    weight_sd <span class="op">=</span> <span class="va">weight_sd</span> <span class="op">/</span> <span class="fl">10</span>,</span>
<span class="r-in">    durnpso_mean <span class="op">=</span> <span class="va">durnpso_mean</span> <span class="op">/</span> <span class="fl">10</span>,</span>
<span class="r-in">    durnpso_sd <span class="op">=</span> <span class="va">durnpso_sd</span> <span class="op">/</span> <span class="fl">10</span>,</span>
<span class="r-in">    <span class="co"># Treatment classes</span></span>
<span class="r-in">    trtclass <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">trtn</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Placebo"</span>,</span>
<span class="r-in">                         <span class="va">trtn</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span> <span class="op">~</span> <span class="st">"IL blocker"</span>,</span>
<span class="r-in">                         <span class="va">trtn</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">~</span> <span class="st">"TNFa blocker"</span><span class="op">)</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Exclude small number of individuals with missing covariates</span></span>
<span class="r-in"><span class="va">pso_ipd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pso_ipd</span>, <span class="va">complete</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">pso_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="combine_network.html">combine_network</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="fu"><a href="set_ipd.html">set_ipd</a></span><span class="op">(</span><span class="va">pso_ipd</span>,</span>
<span class="r-in">          study <span class="op">=</span> <span class="va">studyc</span>,</span>
<span class="r-in">          trt <span class="op">=</span> <span class="va">trtc</span>,</span>
<span class="r-in">          r <span class="op">=</span> <span class="va">pasi75</span>,</span>
<span class="r-in">          trt_class <span class="op">=</span> <span class="va">trtclass</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="fu"><a href="set_agd_arm.html">set_agd_arm</a></span><span class="op">(</span><span class="va">pso_agd</span>,</span>
<span class="r-in">              study <span class="op">=</span> <span class="va">studyc</span>,</span>
<span class="r-in">              trt <span class="op">=</span> <span class="va">trtc</span>,</span>
<span class="r-in">              r <span class="op">=</span> <span class="va">pasi75_r</span>,</span>
<span class="r-in">              n <span class="op">=</span> <span class="va">pasi75_n</span>,</span>
<span class="r-in">              trt_class <span class="op">=</span> <span class="va">trtclass</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Print network details</span></span>
<span class="r-in"><span class="va">pso_net</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A network with 3 IPD studies, and 1 AgD study (arm-based).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">-------------------------------------------------------------------</span> <span style="font-weight: bold;">IPD studies</span> <span style="color: #555555;">----</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Study     Treatment arms                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  UNCOVER-1 3: IXE_Q2W | IXE_Q4W | PBO      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  UNCOVER-2 4: ETN | IXE_Q2W | IXE_Q4W | PBO</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  UNCOVER-3 4: ETN | IXE_Q2W | IXE_Q4W | PBO</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Outcome type: binary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">-------------------------------------------------------</span> <span style="font-weight: bold;">AgD studies (arm-based)</span> <span style="color: #555555;">----</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Study   Treatment arms                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  FIXTURE 4: PBO | ETN | SEC_150 | SEC_300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Outcome type: count</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">------------------------------------------------------------------------------------</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of treatments: 6, in 3 classes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of studies: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reference treatment is: PBO</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Network is <span style="color: #00BB00;">connected</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Add integration points to the network</span></span>
<span class="r-in"><span class="va">pso_net</span> <span class="op">&lt;-</span> <span class="fu">add_integration</span><span class="op">(</span><span class="va">pso_net</span>,</span>
<span class="r-in">  durnpso <span class="op">=</span> <span class="fu"><a href="distr.html">distr</a></span><span class="op">(</span><span class="va">qgamma</span>, mean <span class="op">=</span> <span class="va">durnpso_mean</span>, sd <span class="op">=</span> <span class="va">durnpso_sd</span><span class="op">)</span>,</span>
<span class="r-in">  prevsys <span class="op">=</span> <span class="fu"><a href="distr.html">distr</a></span><span class="op">(</span><span class="va">qbern</span>, prob <span class="op">=</span> <span class="va">prevsys</span><span class="op">)</span>,</span>
<span class="r-in">  bsa <span class="op">=</span> <span class="fu"><a href="distr.html">distr</a></span><span class="op">(</span><span class="va">qlogitnorm</span>, mean <span class="op">=</span> <span class="va">bsa_mean</span>, sd <span class="op">=</span> <span class="va">bsa_sd</span><span class="op">)</span>,</span>
<span class="r-in">  weight <span class="op">=</span> <span class="fu"><a href="distr.html">distr</a></span><span class="op">(</span><span class="va">qgamma</span>, mean <span class="op">=</span> <span class="va">weight_mean</span>, sd <span class="op">=</span> <span class="va">weight_sd</span><span class="op">)</span>,</span>
<span class="r-in">  psa <span class="op">=</span> <span class="fu"><a href="distr.html">distr</a></span><span class="op">(</span><span class="va">qbern</span>, prob <span class="op">=</span> <span class="va">psa</span><span class="op">)</span>,</span>
<span class="r-in">  n_int <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using weighted average correlation matrix computed from IPD studies.</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Adding integration points to a data frame, e.g. for prediction</span></span>
<span class="r-in"><span class="co"># Define a data frame of covariate summaries</span></span>
<span class="r-in"><span class="va">new_agd_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span class="r-in">  bsa_mean <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span class="r-in">  bsa_sd <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span class="r-in">  prevsys <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span class="r-in">  psa <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span class="r-in">  weight_mean <span class="op">=</span> <span class="fl">10</span>,</span>
<span class="r-in">  weight_sd <span class="op">=</span> <span class="fl">1</span>,</span>
<span class="r-in">  durnpso_mean <span class="op">=</span> <span class="fl">3</span>,</span>
<span class="r-in">  durnpso_sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Adding integration points, using the weighted average correlation matrix</span></span>
<span class="r-in"><span class="co"># computed for the plaque psoriasis network</span></span>
<span class="r-in"><span class="va">new_agd_int</span> <span class="op">&lt;-</span> <span class="fu">add_integration</span><span class="op">(</span><span class="va">new_agd_int</span>,</span>
<span class="r-in">  durnpso <span class="op">=</span> <span class="fu"><a href="distr.html">distr</a></span><span class="op">(</span><span class="va">qgamma</span>, mean <span class="op">=</span> <span class="va">durnpso_mean</span>, sd <span class="op">=</span> <span class="va">durnpso_sd</span><span class="op">)</span>,</span>
<span class="r-in">  prevsys <span class="op">=</span> <span class="fu"><a href="distr.html">distr</a></span><span class="op">(</span><span class="va">qbern</span>, prob <span class="op">=</span> <span class="va">prevsys</span><span class="op">)</span>,</span>
<span class="r-in">  bsa <span class="op">=</span> <span class="fu"><a href="distr.html">distr</a></span><span class="op">(</span><span class="va">qlogitnorm</span>, mean <span class="op">=</span> <span class="va">bsa_mean</span>, sd <span class="op">=</span> <span class="va">bsa_sd</span><span class="op">)</span>,</span>
<span class="r-in">  weight <span class="op">=</span> <span class="fu"><a href="distr.html">distr</a></span><span class="op">(</span><span class="va">qgamma</span>, mean <span class="op">=</span> <span class="va">weight_mean</span>, sd <span class="op">=</span> <span class="va">weight_sd</span><span class="op">)</span>,</span>
<span class="r-in">  psa <span class="op">=</span> <span class="fu"><a href="distr.html">distr</a></span><span class="op">(</span><span class="va">qbern</span>, prob <span class="op">=</span> <span class="va">psa</span><span class="op">)</span>,</span>
<span class="r-in">  cor <span class="op">=</span> <span class="va">pso_net</span><span class="op">$</span><span class="va">int_cor</span>,</span>
<span class="r-in">  n_int <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Here, since we reused the correlation matrix pso_net$int_cor from the</span></span>
<span class="r-in"><span class="co"># network, the correct setting of cor_adjust = "spearman" is automatically</span></span>
<span class="r-in"><span class="co"># applied</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">new_agd_int</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 × 13</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   bsa_mean bsa_sd prevsys   psa weight_mean weight_sd durnpso_mean durnpso_sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>      0.6    0.3     0.1   0.2          10         1            3          1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 5 more variables: .int_durnpso &lt;list&gt;, .int_prevsys &lt;list&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   .int_bsa &lt;list&gt;, .int_weight &lt;list&gt;, .int_psa &lt;list&gt;</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by David M. Phillippo.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer></div>

  

  

  </body></html>

